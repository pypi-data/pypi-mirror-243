[tox]
requires =
    tox>=4
env_list =
    py{38,39,310,311,312}
isolated_build = False
skip_missing_interpreters = True

[testenv]
description = run unit tests
deps =
    pytest>=7
    pytest-cov
commands =
    pytest --cov-report=term --cov=vcd {posargs} tests

[testenv:docs]
description = generate documentation
deps =
    pdoc3
allowlist_externals =
    echo
commands =
    pdoc --html --template-dir ./docs/pdoc_templates --output-dir ./docs/pdoc ./vcd --force
commands_post =
    echo "Documentation available at {toxinidir}/docs/pdoc/vcd/index.html"

[testenv:changelog]
description = Run towncrier to check, build, or create the CHANGELOG.md
basepython = python3
skip_install = true
deps =
    git+https://github.com/twisted/towncrier.git
commands =
    towncrier {posargs:build --draft}
