{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://api.byteblower.com/test-framework/json/test-cases/rfc-2544/config-schema.json",
    "title": "Test configuration parameters",
    "description": "Root structure of the JSON configuration file for the ByteBlower RFC 2544 performance Test Case command-line interface.",
    "type": "object",
    "properties": {
        "server": {
            "$ref": "#/$defs/server"
        },
        "source": {
            "$ref": "#/$defs/port"
        },
        "destination": {
            "$ref": "#/$defs/port"
        },
        "maximum_run_time": {
            "$ref": "#/$defs/maximum_run_time"
        },
        "max_iterations": {
            "$ref": "#/$defs/max_iterations"
        },
        "frame_configs": {
            "$ref": "#/$defs/frame_configs"
        }
    },
    "required": [
        "server",
        "source",
        "destination"
    ],
    "additionalProperties": true,
    "$defs": {
        "server": {
            "$$target": "#/$defs/server",
            "title": "ByteBlower server address",
            "description": "Host name or IP address of the ByteBlower Server.",
            "type": "string",
            "oneOf": [
                {
                    "format": "hostname"
                },
                {
                    "format": "ipv4"
                },
                {
                    "format": "ipv6"
                }
            ]
        },
        "port": {
            "$$target": "#/$defs/port",
            "description": "Configuration parameters for a ByteBlower Port",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Name of this ByteBlower port (typically ``Source`` for the tester entity, and ``Destination`` for the DUT)"
                },
                "interface": {
                    "description": "Name of the ByteBlower interface where this ByteBlower port is created",
                    "type": "string"
                },
                "ipv4": {
                    "type": "string",
                    "description": "*ipv4* for static IPv4 ip address, and *dhcp* for dynamic IPv4 address allocation. Default: ``dhcp``."
                },
                "ipv6": {
                    "type": "string",
                    "description": "Define as ``dhcp`` to let the port perform DHCPv6, or as ``slaac`` to let the port perform stateless address auto-configuration."
                },
                "netmask": {
                    "type": "string",
                    "description": "Netmask of the ``ipv4`` network. Default: *Assigned by DHCP* or ``255.255.255.0`` for static IPv4 address configuration.\n\n Note: Will be supported for IPv6 once manual address configuration is supported by the ByteBlower Test Framework."
                },
                "gateway": {
                    "type": "string",
                    "description": "(Default) Gateway of the IPv4 network. Default: Assigned by DHCP or *none* for static IPv4 address configuration.\n\n Note: Will be supported for IPv6 once manual address configuration is supported by the ByteBlower Test Framework."
                },
                "vlans": {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/vlans"
                    },
                    "description": "List of VLAN (stack) configurations. See details in VLAN (stack) configuration."
                },
                "nat": {
                    "type": "bool",
                    "description": "Define whether this port is located behind a NAT gateway. Default to ``false``"
                }
            }
        },
        "maximum_run_time": {
            "$$target": "#/$defs/maximum_run_time",
            "title": "maximum_run_time",
            "type": "number",
            "description": "Maximum run time of a single test trial in seconds",
            "format": "float"
        },
        "max_iterations": {
            "$$target": "#/$defs/max_iterations",
            "title": "max_iterations",
            "type": "number",
            "description": "Maximum number of iteration to test per frame size",
            "format": "integer"
        },
        "frame_configs": {
            "$$target": "#/$defs/frame_configs",
            "type": "object",
            "properties": {
                "size": {
                    "type": "integer",
                    "description": "Frame length in Bytes without the FCS (Frame Check Sequence, 4 Bytes)"
                },
                "initial_bitrate": {
                    "type": "float",
                    "description": "Initial bitrate to be used in the first trial of the RFC 2544 throughput test."
                },
                "tolerated_frame_loss": {
                    "type": "float",
                    "description": "The maximum acceptable frame loss during the test."
                },
                "accuracy": {
                    "type": "float",
                    "description": "Defines the test accuracy (precision) at which the test should be ended."
                },
                "expected_bitrate": {
                    "type": "string",
                    "description": "The expected maximum Ethernet layer 2 speed for frames without the 4 bytes of FCS. Usually, it is around the maximum theoretical speed of the tested network."
                }
            }
        },
        "vlans": {
            "title": "VLAN (stack) configuration",
            "$$target": "#/$defs/vlans",
            "type": "object",
            "properties": {
                "protocol_id": {
                    "type": "integer",
                    "description": "VLAN protocol ID (TPID). Default value is: \n\n* '0x8100' for a single VLAN configuration \n\n* '0x88a8' for the outer VLAN(s) in a VLAN stack configuration \n\n* '0x8100' for the most inner VLAN in a VLAN stack configuration.\n\nNote: Configuration of the VLAN protocol ID (TPID) requires ByteBlower Server version >= 2.20.0."
                },
                "id": {
                    "type": "integer",
                    "description": "VLAN ID (12-bit; 0-4095)"
                },
                "priority": {
                    "type": "integer",
                    "description": "3 bits defining the VLAN PCP bits. Default: 0"
                },
                "drop_eligible": {
                    "type": "integer",
                    "description": "1-bit flag. Default: 0"
                }
            }
        }
    }
}
