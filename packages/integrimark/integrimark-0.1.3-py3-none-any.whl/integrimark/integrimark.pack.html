<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Download protected by IntegriMark</title><script src="https://unpkg.com/pdf-lib@1.16.0/dist/pdf-lib.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script><style>body{font-family:Arial,sans-serif;background-color:#e6f9e6;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}.frame{background-color:#b2e0b2;padding:20px;border-radius:10px;max-width:500px;max-height:400px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,.1)}h1{font-size:24px;margin-bottom:20px}footer{font-size:10px;position:absolute;bottom:10px;width:100%;text-align:center}a{color:#070;text-decoration:none}a:hover{text-decoration:underline}</style><script src="routing.js"></script></head><body><div class="frame"><h1>Download protected by IntegriMark</h1><p id="errorMessage" style="color: red; display: none;">You are not authorized to access this page.</p><form id="pdfForm" style="display: none;"><input type="hidden" id="fileUrl" value=""></form><p>Currently preparing a protected version of the file <strong id="filenameDisplay"></strong>...</p><a id="downloadLink" style="display: none;">Click here if the download doesn't start automatically</a></div><footer>Protected by IntegriMark, made with <span style="color: #e25555;">&hearts;</span> by <a href="https://directory.seas.upenn.edu/jeremie-o-lumbroso/">Jérémie Lumbroso, Penn CIS</a>.</footer><script>async function main(){let I=document.createElement("canvas").getContext("2d");async function e(e,r,o,a){try{let t=e;if(r){var n=CryptoJS.AES.decrypt(CryptoJS.lib.WordArray.create(e).toString(CryptoJS.enc.Base64),r);t=new Uint8Array(n.sigBytes);for(let e=0;e<n.sigBytes;e++)t[e]=n.words[e>>>2]>>>24-e%4*8&255}var i=await PDFLib.PDFDocument.load(t),l=i.getPages(),s=new Date,c=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}@${String(s.getHours()).padStart(2,"0")}:`+String(s.getMinutes()).padStart(2,"0"),d=o.replace("@","[at]"),g=[.7,1,.7],p=`This document has been exclusively prepared for ${o} on ${c}. For any other person to view this document is a course violation.`,y=(x=d,U=20,I.font=U+"px Helvetica",I.measureText(x).width);for(const L of l){var{width:m,height:u}=L.getSize();let e=!1;var f=y/2;let o=0;for(let r=u;0<r;r-=24){let t=0;t-=o,e&&(t=-f,t+=o);for(let e=t;e<m;e+=y)L.drawText(d,{x:e,y:r,size:20,color:new PDFLib.rgb(g[0],g[1],g[2]),opacity:.45});e=!e,o+=2}L.drawText(p,{x:10,y:14,size:8,opacity:.5})}for(const C of l){var w=C.getSize()["height"];for(let e=w;0<e;e-=1.5)C.drawText(function(t){var r=["ba","la","na","mo","to","po","ki","ri","mi","fu","lu","du","su","pu","ka","ta","pa","bo"," "," "," "," "," "," "," "," "," "," "," "," "];let o="";for(let e=0;e<t;e++)o+=r[Math.floor(Math.random()*r.length)];return o}(400),{x:0,y:e,size:10,color:PDFLib.rgb(1,1,1),opacity:0})}var h=M.split(".").slice(0,-1).join("."),v=M.split(".").pop(),S=h+`-${o}.`+v,b=(a&&(S=a.split("/").pop().split(".").slice(0,-1).join(".")+`-${o}.`+v),await i.save()),B=new Blob([b],{type:"application/pdf"}),E=URL.createObjectURL(B),k=document.getElementById("downloadLink");k.href=E,k.download=S,k.style.display="block",k.click()}catch(e){throw e}var x,U}var t=window.location.pathname;let r=t,o=integrimarkRoutes[r];if(o||(r=function(e){var t=e.split("/");for(let e=0;e<t.length;e++)if(t[e]){t.splice(e,1);break}return t.join("/")}(t),!(o=integrimarkRoutes[r])&&1<r.length&&(r=r.substring(1),o=integrimarkRoutes[r])),!(o=o&&(t=integrimarkBaseURL,a=o,new URL(a,t).toString())))return document.getElementById("errorMessage").textContent="Invalid URL.",void(document.getElementById("errorMessage").style.display="block");document.getElementById("fileUrl").value=o;var a=new URLSearchParams(window.location.search),t=a.get("email"),n=a.get("key");if(!t||!n)return document.getElementById("errorMessage").textContent="Malformed URL.",void(document.getElementById("errorMessage").style.display="block");i=t,n=n,i=CryptoJS.SHA256(i).toString().slice(0,32);var n=CryptoJS.AES.decrypt(n,i).toString(CryptoJS.enc.Utf8),i=await(await fetch(document.getElementById("fileUrl").value)).arrayBuffer(),i=new Uint8Array(i);const M=o.split("/").pop();var l=r;document.getElementById("filenameDisplay").textContent=l;try{await e(i,n,t,l)}catch(e){console.error("Error processing PDF:",e),document.getElementById("errorMessage").textContent="Error processing the PDF. Please try again later or with new URL.",document.getElementById("errorMessage").style.display="block"}}main();</script></body></html>