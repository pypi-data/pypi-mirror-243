import{S as ge,i as ve,s as be,D as Ee,Z as ke,_ as Se,m as w,h as f,n as _,$ as Fe,b as x,a0 as c,K as rt,a1 as ee,M as ze,Q as Me,q as J,r as j,u as ne,P as nt,am as it,ai as ot,k as S,a as A,y as G,l as V,c as F,z as U,A as H,G as he,g as P,d as z,B as L,O as $e,N as Ze,al as ce,an as _e,v as ye,f as Re,L as ut,a2 as ct,p as fe,ab as xe,w as Oe,U as Ke,F as Be,V as Ge}from"../chunks/index.6d58eddb.js";import{D as ft}from"../chunks/DatasetFieldEmbeddingSelector.e7ed697e.js";import{P as dt}from"../chunks/Page.d3a77107.js";import{w as mt}from"../chunks/index.fcc110a5.js";import{bg as pt,bh as ht,A as _t,M as gt,G as vt,H as bt,a9 as Ue,a6 as wt,aN as Et,aj as de,ai as me,c as et,a4 as kt,d as St,aS as Vt,J as It,aU as Nt,aV as $t,bp as yt}from"../chunks/Commands.83bc508c.js";import{T as Rt}from"../chunks/TextArea.b5118116.js";import{c as pe}from"../chunks/colors.f6cbcb11.js";import{S as Tt}from"../chunks/Search.5f4df38b.js";class Dt{static generateCompletion(t){return pt(ht,{method:"GET",url:"/api/v1/rag/generate_completion",query:{prompt:t},errors:{422:"Validation Error"}})}}function He(l){let t,s;return{c(){t=ke("title"),s=J(l[1])},l(e){t=Se(e,"title",{});var a=w(t);s=j(a,l[1]),a.forEach(f)},m(e,a){x(e,t,a),c(t,s)},p(e,a){a&2&&ne(s,e[1])},d(e){e&&f(t)}}}function qt(l){let t,s,e=l[1]&&He(l),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:l[0]},{height:l[0]},l[2],l[3]],n={};for(let i=0;i<a.length;i+=1)n=Ee(n,a[i]);return{c(){t=ke("svg"),e&&e.c(),s=ke("path"),this.h()},l(i){t=Se(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var r=w(t);e&&e.l(r),s=Se(r,"path",{d:!0}),w(s).forEach(f),r.forEach(f),this.h()},h(){_(s,"d","M2 26H30V28H2zM25.4 9c.8-.8.8-2 0-2.8 0 0 0 0 0 0l-3.6-3.6c-.8-.8-2-.8-2.8 0 0 0 0 0 0 0l-15 15V24h6.4L25.4 9zM20.4 4L24 7.6l-3 3L17.4 7 20.4 4zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"),Fe(t,n)},m(i,r){x(i,t,r),e&&e.m(t,null),c(t,s)},p(i,[r]){i[1]?e?e.p(i,r):(e=He(i),e.c(),e.m(t,s)):e&&(e.d(1),e=null),Fe(t,n=rt(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},r&1&&{width:i[0]},r&1&&{height:i[0]},r&4&&i[2],r&8&&i[3]]))},i:ee,o:ee,d(i){i&&f(t),e&&e.d()}}}function Ct(l,t,s){let e,a;const n=["size","title"];let i=ze(t,n),{size:r=16}=t,{title:u=void 0}=t;return l.$$set=m=>{s(5,t=Ee(Ee({},t),Me(m))),s(3,i=ze(t,n)),"size"in m&&s(0,r=m.size),"title"in m&&s(1,u=m.title)},l.$$.update=()=>{s(4,e=t["aria-label"]||t["aria-labelledby"]||u),s(2,a={"aria-hidden":e?void 0:!0,role:e?"img":void 0,focusable:Number(t.tabindex)===0?!0:void 0})},t=Me(t),[r,u,a,i,e]}class Pt extends ge{constructor(t){super(),ve(this,t,Ct,qt,be,{size:0,title:1})}}const Ve="RAG_VIEW_CONTEXT",tt="{query_str}",Ie="{context_str}";function Ne(){return{datasetNamespace:null,datasetName:null,path:null,embedding:null,query:null,promptTemplate:`Context information is below.
---------------------
${Ie}
---------------------
Given the context information and not prior knowledge, answer the query.
Query: ${tt}
Answer: `,topK:10,windowSizeChunks:1}}function At(){const l=Ne(),{subscribe:t,set:s,update:e}=mt(JSON.parse(JSON.stringify(l)));return{subscribe:t,set:s,update:e,reset:()=>{s(JSON.parse(JSON.stringify(l)))},setDatasetPathEmbedding:(n,i,r)=>{e(u=>(n==null?(u.datasetNamespace=null,u.datasetName=null):(u.datasetNamespace=n.namespace,u.datasetName=n.name),u.path=i,u.embedding=r,u))},setQuestion:n=>{e(i=>(i.query=n,i))}}}function Ft(l){nt(Ve,l)}function st(){if(!it(Ve))throw new Error("RagViewContext not found");return ot(Ve)}function zt(l){let t,s;return t=new Rt({props:{value:l[2]||void 0,placeholder:"Enter a prompt template...",rows:12,class:"mb-2 w-full"}}),t.$on("input",l[4]),{c(){G(t.$$.fragment)},l(e){U(t.$$.fragment,e)},m(e,a){H(t,e,a),s=!0},p(e,a){const n={};a&4&&(n.value=e[2]||void 0),t.$set(n)},i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){z(t.$$.fragment,e),s=!1},d(e){L(t,e)}}}function Mt(l){let t,s,e,a,n,i;return t=new gt({props:{title:"Edit prompt template"}}),e=new vt({props:{hasForm:!0,$$slots:{default:[zt]},$$scope:{ctx:l}}}),n=new bt({props:{primaryButtonText:"Save",secondaryButtonText:"Close",primaryButtonDisabled:!1}}),n.$on("click:button--secondary",l[11]),{c(){G(t.$$.fragment),s=A(),G(e.$$.fragment),a=A(),G(n.$$.fragment)},l(r){U(t.$$.fragment,r),s=F(r),U(e.$$.fragment,r),a=F(r),U(n.$$.fragment,r)},m(r,u){H(t,r,u),x(r,s,u),H(e,r,u),x(r,a,u),H(n,r,u),i=!0},p(r,u){const m={};u&32772&&(m.$$scope={dirty:u,ctx:r}),e.$set(m)},i(r){i||(P(t.$$.fragment,r),P(e.$$.fragment,r),P(n.$$.fragment,r),i=!0)},o(r){z(t.$$.fragment,r),z(e.$$.fragment,r),z(n.$$.fragment,r),i=!1},d(r){L(t,r),r&&f(s),L(e,r),r&&f(a),L(n,r)}}}function xt(l){let t,s,e,a,n,i,r,u,m,p,g,R,E,v,h,y;return u=new Pt({}),E=new _t({props:{open:l[1],$$slots:{default:[Mt]},$$scope:{ctx:l}}}),E.$on("submit",l[5]),E.$on("close",l[12]),{c(){t=S("div"),s=S("div"),e=S("div"),a=J("Prompt"),n=A(),i=S("div"),r=S("button"),G(u.$$.fragment),m=A(),p=S("div"),g=J(l[0]),R=A(),G(E.$$.fragment),this.h()},l(I){t=V(I,"DIV",{class:!0});var o=w(t);s=V(o,"DIV",{class:!0});var b=w(s);e=V(b,"DIV",{});var T=w(e);a=j(T,"Prompt"),T.forEach(f),n=F(b),i=V(b,"DIV",{class:!0});var k=w(i);r=V(k,"BUTTON",{});var q=w(r);U(u.$$.fragment,q),q.forEach(f),k.forEach(f),b.forEach(f),m=F(o),p=V(o,"DIV",{class:!0});var d=w(p);g=j(d,l[0]),d.forEach(f),o.forEach(f),R=F(I),U(E.$$.fragment,I),this.h()},h(){_(i,"class","h-4"),_(s,"class","rag-section-header mb-4 flex w-full flex-row justify-between"),_(p,"class","h-96 overflow-y-scroll whitespace-break-spaces leading-6"),_(t,"class","flex h-full w-full flex-col overflow-y-scroll")},m(I,o){x(I,t,o),c(t,s),c(s,e),c(e,a),c(s,n),c(s,i),c(i,r),H(u,r,null),c(t,m),c(t,p),c(p,g),x(I,R,o),H(E,I,o),v=!0,h||(y=he(r,"click",l[10]),h=!0)},p(I,[o]){(!v||o&1)&&ne(g,I[0]);const b={};o&2&&(b.open=I[1]),o&32774&&(b.$$scope={dirty:o,ctx:I}),E.$set(b)},i(I){v||(P(u.$$.fragment,I),P(E.$$.fragment,I),v=!0)},o(I){z(u.$$.fragment,I),z(E.$$.fragment,I),v=!1},d(I){I&&f(t),L(u),I&&f(R),L(E,I),h=!1,y()}}}function Ot(l,t,s){let e,a,n,{questionInputText:i}=t,{retrievalResults:r}=t;const u=st();$e(l,u,o=>s(9,n=o));const m=Ze();let p=!1,g="";function R(o,b){return g.replace(tt,o).replace(Ie,b)}function E(o){s(2,g=o.target.value)}function v(){s(1,p=!1)}const h=()=>s(1,p=!0),y=()=>{close(),s(1,p=!1)},I=()=>s(1,p=!1);return l.$$set=o=>{"questionInputText"in o&&s(6,i=o.questionInputText),"retrievalResults"in o&&s(7,r=o.retrievalResults)},l.$$.update=()=>{l.$$.dirty&512&&n.promptTemplate!=null&&s(2,g=n.promptTemplate),l.$$.dirty&128&&s(8,e=r==null?Ie:r.map(o=>o.contextText).join(`
`)),l.$$.dirty&320&&s(0,a=R(i,e)),l.$$.dirty&641&&r!=null&&n.query!=null&&m("prompt",a)},[a,p,g,u,E,v,i,r,e,n,h,y,I]}class Kt extends ge{constructor(t){super(),ve(this,t,Ot,xt,be,{questionInputText:6,retrievalResults:7})}}function Le(l,t,s){var i,r,u,m;const e=l.slice();e[14]=t[s];const a=e[14].text.slice((i=e[14].windowSpan)==null?void 0:i.start,(r=e[14].span)==null?void 0:r.start);e[15]=a;const n=e[14].text.slice((u=e[14].span)==null?void 0:u.end,(m=e[14].windowSpan)==null?void 0:m.end);return e[16]=n,e}function Qe(l){let t,s;return t=new et({props:{lines:l[1].topK}}),{c(){G(t.$$.fragment)},l(e){U(t.$$.fragment,e)},m(e,a){H(t,e,a),s=!0},p(e,a){const n={};a&2&&(n.lines=e[1].topK),t.$set(n)},i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){z(t.$$.fragment,e),s=!1},d(e){L(t,e)}}}function Je(l){let t,s=l[0],e=[];for(let a=0;a<s.length;a+=1)e[a]=Ye(Le(l,s,a));return{c(){t=S("div");for(let a=0;a<e.length;a+=1)e[a].c();this.h()},l(a){t=V(a,"DIV",{class:!0});var n=w(t);for(let i=0;i<e.length;i+=1)e[i].l(n);n.forEach(f),this.h()},h(){_(t,"class","flex h-96 flex-col overflow-y-scroll")},m(a,n){x(a,t,n);for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(t,null)},p(a,n){if(n&1){s=a[0];let i;for(i=0;i<s.length;i+=1){const r=Le(a,s,i);e[i]?e[i].p(r,n):(e[i]=Ye(r),e[i].c(),e[i].m(t,null))}for(;i<e.length;i+=1)e[i].d(1);e.length=s.length}},d(a){a&&f(t),ct(e,a)}}}function je(l){let t,s=l[15]+"",e;return{c(){t=S("span"),e=J(s),this.h()},l(a){t=V(a,"SPAN",{class:!0});var n=w(t);e=j(n,s),n.forEach(f),this.h()},h(){_(t,"class","whitespace-break-spaces")},m(a,n){x(a,t,n),c(t,e)},p(a,n){n&1&&s!==(s=a[15]+"")&&ne(e,s)},d(a){a&&f(t)}}}function Xe(l){let t,s=l[16]+"",e;return{c(){t=S("span"),e=J(s),this.h()},l(a){t=V(a,"SPAN",{class:!0});var n=w(t);e=j(n,s),n.forEach(f),this.h()},h(){_(t,"class","whitespace-break-spaces")},m(a,n){x(a,t,n),c(t,e)},p(a,n){n&1&&s!==(s=a[16]+"")&&ne(e,s)},d(a){a&&f(t)}}}function Ye(l){var y,I;let t,s,e,a=l[14].score.toFixed(2)+"",n,i,r,u,m,p=l[14].text.slice((y=l[14].span)==null?void 0:y.start,(I=l[14].span)==null?void 0:I.end)+"",g,R,E,v=l[15]!=""&&je(l),h=l[16]!=""&&Xe(l);return{c(){t=S("div"),s=S("div"),e=S("span"),n=J(a),i=A(),r=S("div"),v&&v.c(),u=A(),m=S("span"),g=J(p),R=A(),h&&h.c(),E=A(),this.h()},l(o){t=V(o,"DIV",{class:!0});var b=w(t);s=V(b,"DIV",{class:!0});var T=w(s);e=V(T,"SPAN",{class:!0});var k=w(e);n=j(k,a),k.forEach(f),T.forEach(f),i=F(b),r=V(b,"DIV",{class:!0});var q=w(r);v&&v.l(q),u=F(q),m=V(q,"SPAN",{class:!0});var d=w(m);g=j(d,p),d.forEach(f),R=F(q),h&&h.l(q),q.forEach(f),E=F(b),b.forEach(f),this.h()},h(){_(e,"class","px-0.5"),fe(e,"background-color",pe(l[14].score)),_(s,"class","w-16"),_(m,"class","whitespace-break-spaces"),fe(m,"background-color",pe(l[14].score)),_(r,"class","grow"),_(t,"class","flex flex-row gap-x-2 border-b border-b-neutral-200 py-2 text-sm")},m(o,b){x(o,t,b),c(t,s),c(s,e),c(e,n),c(t,i),c(t,r),v&&v.m(r,null),c(r,u),c(r,m),c(m,g),c(r,R),h&&h.m(r,null),c(t,E)},p(o,b){var T,k;b&1&&a!==(a=o[14].score.toFixed(2)+"")&&ne(n,a),b&1&&fe(e,"background-color",pe(o[14].score)),o[15]!=""?v?v.p(o,b):(v=je(o),v.c(),v.m(r,u)):v&&(v.d(1),v=null),b&1&&p!==(p=o[14].text.slice((T=o[14].span)==null?void 0:T.start,(k=o[14].span)==null?void 0:k.end)+"")&&ne(g,p),b&1&&fe(m,"background-color",pe(o[14].score)),o[16]!=""?h?h.p(o,b):(h=Xe(o),h.c(),h.m(r,null)):h&&(h.d(1),h=null)},d(o){o&&f(t),v&&v.d(),h&&h.d()}}}function Bt(l){var M;let t,s,e,a,n,i,r,u,m,p,g,R,E,v,h,y,I,o,b,T,k,q,d=((M=l[2])==null?void 0:M.isFetching)&&Qe(l),D=l[0]!=null&&Je(l);return{c(){t=S("div"),s=S("div"),e=J("Retrieval"),a=A(),n=S("div"),i=S("div"),r=S("span"),u=J("Chunk window"),m=A(),p=S("input"),g=A(),R=S("div"),E=S("span"),v=J("Top K"),h=A(),y=S("input"),I=A(),o=S("div"),d&&d.c(),b=A(),D&&D.c(),this.h()},l(N){t=V(N,"DIV",{class:!0});var C=w(t);s=V(C,"DIV",{});var X=w(s);e=j(X,"Retrieval"),X.forEach(f),a=F(C),n=V(C,"DIV",{class:!0});var B=w(n);i=V(B,"DIV",{});var O=w(i);r=V(O,"SPAN",{class:!0});var Q=w(r);u=j(Q,"Chunk window"),Q.forEach(f),m=F(O),p=V(O,"INPUT",{type:!0,class:!0,min:!0,max:!0}),O.forEach(f),g=F(B),R=V(B,"DIV",{});var Y=w(R);E=V(Y,"SPAN",{class:!0});var le=w(E);v=j(le,"Top K"),le.forEach(f),h=F(Y),y=V(Y,"INPUT",{type:!0,class:!0}),Y.forEach(f),B.forEach(f),C.forEach(f),I=F(N),o=V(N,"DIV",{class:!0});var W=w(o);d&&d.l(W),b=F(W),D&&D.l(W),W.forEach(f),this.h()},h(){_(r,"class","mr-2"),_(p,"type","number"),_(p,"class","w-16 px-2"),_(p,"min","0"),_(p,"max","10"),_(E,"class","mr-2"),_(y,"type","number"),_(y,"class","w-16 px-2"),_(n,"class","flex h-4 flex-row gap-x-4 font-normal"),_(t,"class","rag-section-header mb-4 flex w-full flex-row justify-between"),_(o,"class","mb-8 h-full")},m(N,C){x(N,t,C),c(t,s),c(s,e),c(t,a),c(t,n),c(n,i),c(i,r),c(r,u),c(i,m),c(i,p),ce(p,l[1].windowSizeChunks),c(n,g),c(n,R),c(R,E),c(E,v),c(R,h),c(R,y),ce(y,l[1].topK),x(N,I,C),x(N,o,C),d&&d.m(o,null),c(o,b),D&&D.m(o,null),T=!0,k||(q=[he(p,"input",l[11]),he(y,"input",l[12])],k=!0)},p(N,[C]){var X;C&2&&_e(p.value)!==N[1].windowSizeChunks&&ce(p,N[1].windowSizeChunks),C&2&&_e(y.value)!==N[1].topK&&ce(y,N[1].topK),(X=N[2])!=null&&X.isFetching?d?(d.p(N,C),C&4&&P(d,1)):(d=Qe(N),d.c(),P(d,1),d.m(o,b)):d&&(ye(),z(d,1,1,()=>{d=null}),Re()),N[0]!=null?D?D.p(N,C):(D=Je(N),D.c(),D.m(o,null)):D&&(D.d(1),D=null)},i(N){T||(P(d),T=!0)},o(N){z(d),T=!1},d(N){N&&f(t),N&&f(I),N&&f(o),d&&d.d(),D&&D.d(),k=!1,ut(q)}}}function Gt(l,t,s){let e,a,n,i,r,u,m=ee,p=()=>(m(),m=xe(n,k=>s(2,u=k)),n),g,R=ee,E=()=>(R(),R=xe(a,k=>s(10,g=k)),a);l.$$.on_destroy.push(()=>m()),l.$$.on_destroy.push(()=>R());let{retrievalResults:v=void 0}=t;const h=st();$e(l,h,k=>s(1,r=k));let{isFetching:y=!1}=t;const I=Ze();let o=null;function b(){r.windowSizeChunks=_e(this.value),h.set(r)}function T(){r.topK=_e(this.value),h.set(r)}return l.$$set=k=>{"retrievalResults"in k&&s(0,v=k.retrievalResults),"isFetching"in k&&s(6,y=k.isFetching)},l.$$.update=()=>{var k;l.$$.dirty&2&&s(9,e={path:r.path,query:r.query,query_type:"question",embedding:r.embedding,type:"semantic"}),l.$$.dirty&514&&r.path&&r.embedding&&r.query!=null&&s(7,o={columns:[Ue,r.path],limit:r.topK,combine_columns:!0,searches:[e]}),l.$$.dirty&130&&E(s(4,a=o&&r.datasetNamespace&&r.datasetName?wt(r.datasetNamespace,r.datasetName,{columns:o.columns,searches:o.searches,combine_columns:o.combine_columns}):null)),l.$$.dirty&1154&&p(s(3,n=o!=null&&r.datasetNamespace!=null&&r.datasetName!=null&&(g==null?void 0:g.data)!=null?Et(r.datasetNamespace,r.datasetName,o,g.data.schema):null)),l.$$.dirty&1028&&s(6,y=(u==null?void 0:u.isFetching)||(g==null?void 0:g.isFetching)||!1),l.$$.dirty&64&&y&&s(0,v=void 0),l.$$.dirty&1024&&s(8,i=(g==null?void 0:g.data)!=null?kt(g.data.schema).filter(q=>q.signal!=null&&q.signal.signal_name==="semantic_similarity")[0]:null),l.$$.dirty&262&&i!=null&&r.path!=null&&(u==null?void 0:u.data)!=null&&s(0,v=(((k=u.data)==null?void 0:k.rows)||[]).flatMap(q=>{const d=de(q,i.path);if(d==null)return[];const D=me.value(de(q,r.path)),M=[],N=[];for(const C of d){const X=me.span(C),B=me.value(de(C,["score"]),"float32");N.push({span:X,score:B,text:D})}for(const[C,{span:X,score:B,text:O}]of N.entries()){const Q=N[Math.max(0,C-r.windowSizeChunks)].span,Y=N[Math.min(N.length-1,C+r.windowSizeChunks)].span,le=O.slice(Q==null?void 0:Q.start,Y==null?void 0:Y.end);M.push({rowid:me.value(de(q,[Ue])),span:X,windowSpan:{start:Q.start,end:Y.end},text:O,contextText:le,score:B,spanIndex:C,rowChunkSpans:N.map(W=>W.span)})}return M}).sort((q,d)=>d.score-q.score).slice(0,r.topK)),l.$$.dirty&1&&I("results",v)},[v,r,u,n,a,h,y,o,i,e,g,b,T]}class Ut extends ge{constructor(t){super(),ve(this,t,Gt,Bt,be,{retrievalResults:0,isFetching:6})}}function Ht(l){let t,s;return{c(){t=S("div"),s=J("Press the search button to answer the question."),this.h()},l(e){t=V(e,"DIV",{class:!0});var a=w(t);s=j(a,"Press the search button to answer the question."),a.forEach(f),this.h()},h(){_(t,"class","whitespace-break-spaces font-light italic leading-5")},m(e,a){x(e,t,a),c(t,s)},p:ee,i:ee,o:ee,d(e){e&&f(t)}}}function Lt(l){let t,s,e;return s=new yt({props:{source:l[10]}}),{c(){t=S("div"),G(s.$$.fragment),this.h()},l(a){t=V(a,"DIV",{class:!0});var n=w(t);U(s.$$.fragment,n),n.forEach(f),this.h()},h(){_(t,"class","markdown whitespace-break-spaces leading-5 svelte-10ktfub")},m(a,n){x(a,t,n),H(s,t,null),e=!0},p(a,n){const i={};n&1024&&(i.source=a[10]),s.$set(i)},i(a){e||(P(s.$$.fragment,a),e=!0)},o(a){z(s.$$.fragment,a),e=!1},d(a){a&&f(t),L(s)}}}function Qt(l){let t,s;return t=new et({}),{c(){G(t.$$.fragment)},l(e){U(t.$$.fragment,e)},m(e,a){H(t,e,a),s=!0},p:ee,i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){z(t.$$.fragment,e),s=!1},d(e){L(t,e)}}}function Jt(l){let t,s,e,a,n,i,r,u,m,p,g,R,E,v,h,y,I,o,b,T,k,q,d,D,M,N,C,X,B,O,Q,Y,le;p=new Tt({props:{size:16}}),E=new It({props:{value:l[6],size:"xl",disabled:l[1].datasetName==null,placeholder:l[1].datasetName!=null?"Enter a question":"Choose a dataset"}}),E.$on("input",l[12]),E.$on("change",l[13]);const W=[Qt,Lt,Ht],te=[];function Te($,K){return $[9]||$[8]?0:$[10]!=null?1:2}T=Te(l),k=te[T]=W[T](l);function at($){l[16]($)}function lt($){l[17]($)}let we={};return l[7]!==void 0&&(we.retrievalResults=l[7]),l[8]!==void 0&&(we.isFetching=l[8]),M=new Ut({props:we}),Oe.push(()=>Ke(M,"retrievalResults",at)),Oe.push(()=>Ke(M,"isFetching",lt)),O=new Kt({props:{questionInputText:l[6],retrievalResults:l[7]}}),O.$on("prompt",l[18]),{c(){t=S("div"),s=S("div"),e=S("div"),a=S("div"),n=S("div"),i=J("Question"),r=A(),u=S("div"),m=S("button"),G(p.$$.fragment),R=A(),G(E.$$.fragment),v=A(),h=S("div"),y=S("div"),I=J("Answer"),o=A(),b=S("div"),k.c(),q=A(),d=S("div"),D=S("div"),G(M.$$.fragment),X=A(),B=S("div"),G(O.$$.fragment),this.h()},l($){t=V($,"DIV",{class:!0});var K=w(t);s=V(K,"DIV",{class:!0});var Z=w(s);e=V(Z,"DIV",{class:!0});var se=w(e);a=V(se,"DIV",{class:!0});var ae=w(a);n=V(ae,"DIV",{class:!0});var re=w(n);i=j(re,"Question"),re.forEach(f),r=F(ae),u=V(ae,"DIV",{class:!0});var ie=w(u);m=V(ie,"BUTTON",{class:!0});var De=w(m);U(p.$$.fragment,De),De.forEach(f),R=F(ie),U(E.$$.fragment,ie),ie.forEach(f),ae.forEach(f),v=F(se),h=V(se,"DIV",{class:!0});var oe=w(h);y=V(oe,"DIV",{class:!0});var qe=w(y);I=j(qe,"Answer"),qe.forEach(f),o=F(oe),b=V(oe,"DIV",{class:!0});var Ce=w(b);k.l(Ce),Ce.forEach(f),oe.forEach(f),se.forEach(f),q=F(Z),d=V(Z,"DIV",{class:!0});var ue=w(d);D=V(ue,"DIV",{class:!0});var Pe=w(D);U(M.$$.fragment,Pe),Pe.forEach(f),X=F(ue),B=V(ue,"DIV",{class:!0});var Ae=w(B);U(O.$$.fragment,Ae),Ae.forEach(f),ue.forEach(f),Z.forEach(f),K.forEach(f),this.h()},h(){_(n,"class","font-medium"),_(m,"class","z-10 -mr-10 mb-2"),m.disabled=g=l[1].datasetName==null,Be(m,"opacity-10",l[1].datasetName==null),_(u,"class","question-input flex w-full flex-row items-end"),_(a,"class","flex flex-col gap-y-4"),_(y,"class","font-medium"),_(b,"class","pt-4"),_(h,"class","flex flex-col gap-y-4"),_(e,"class","mt-6 flex w-1/2 flex-col gap-y-10"),_(D,"class","w-1/2"),_(B,"class","w-1/2"),_(d,"class","flex grow flex-row gap-x-8"),_(s,"class","mx-4 mb-8 mt-2 flex h-full w-full flex-col items-start gap-y-24 px-4"),_(t,"class","h-full w-full overflow-x-hidden overflow-y-scroll")},m($,K){x($,t,K),c(t,s),c(s,e),c(e,a),c(a,n),c(n,i),c(a,r),c(a,u),c(u,m),H(p,m,null),c(u,R),H(E,u,null),c(e,v),c(e,h),c(h,y),c(y,I),c(h,o),c(h,b),te[T].m(b,null),c(s,q),c(s,d),c(d,D),H(M,D,null),c(d,X),c(d,B),H(O,B,null),Q=!0,Y||(le=he(m,"click",l[15]),Y=!0)},p($,K){(!Q||K&2&&g!==(g=$[1].datasetName==null))&&(m.disabled=g),(!Q||K&2)&&Be(m,"opacity-10",$[1].datasetName==null);const Z={};K&64&&(Z.value=$[6]),K&2&&(Z.disabled=$[1].datasetName==null),K&2&&(Z.placeholder=$[1].datasetName!=null?"Enter a question":"Choose a dataset"),E.$set(Z);let se=T;T=Te($),T===se?te[T].p($,K):(ye(),z(te[se],1,1,()=>{te[se]=null}),Re(),k=te[T],k?k.p($,K):(k=te[T]=W[T]($),k.c()),P(k,1),k.m(b,null));const ae={};!N&&K&128&&(N=!0,ae.retrievalResults=$[7],Ge(()=>N=!1)),!C&&K&256&&(C=!0,ae.isFetching=$[8],Ge(()=>C=!1)),M.$set(ae);const re={};K&64&&(re.questionInputText=$[6]),K&128&&(re.retrievalResults=$[7]),O.$set(re)},i($){Q||(P(p.$$.fragment,$),P(E.$$.fragment,$),P(k),P(M.$$.fragment,$),P(O.$$.fragment,$),Q=!0)},o($){z(p.$$.fragment,$),z(E.$$.fragment,$),z(k),z(M.$$.fragment,$),z(O.$$.fragment,$),Q=!1},d($){$&&f(t),L(p),L(E),te[T].d(),L(M),L(O),Y=!1,le()}}}function jt(l){let t,s;return{c(){t=S("div"),s=J("Retrival Augmented Generation (RAG)"),this.h()},l(e){t=V(e,"DIV",{slot:!0,class:!0});var a=w(t);s=j(a,"Retrival Augmented Generation (RAG)"),a.forEach(f),this.h()},h(){_(t,"slot","header-subtext"),_(t,"class","text-lg")},m(e,a){x(e,t,a),c(t,s)},p:ee,d(e){e&&f(t)}}}function We(l){let t,s;return t=new ft({props:{inputSize:"sm",dataset:l[3],path:l[4],embedding:l[5]}}),t.$on("change",l[14]),{c(){G(t.$$.fragment)},l(e){U(t.$$.fragment,e)},m(e,a){H(t,e,a),s=!0},p(e,a){const n={};a&8&&(n.dataset=e[3]),a&16&&(n.path=e[4]),a&32&&(n.embedding=e[5]),t.$set(n)},i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){z(t.$$.fragment,e),s=!1},d(e){L(t,e)}}}function Xt(l){let t,s,e=l[2]&&We(l);return{c(){t=S("div"),e&&e.c(),this.h()},l(a){t=V(a,"DIV",{slot:!0,class:!0});var n=w(t);e&&e.l(n),n.forEach(f),this.h()},h(){_(t,"slot","header-right"),_(t,"class","dataset-selector py-2 svelte-10ktfub")},m(a,n){x(a,t,n),e&&e.m(t,null),s=!0},p(a,n){a[2]?e?(e.p(a,n),n&4&&P(e,1)):(e=We(a),e.c(),P(e,1),e.m(t,null)):e&&(ye(),z(e,1,1,()=>{e=null}),Re())},i(a){s||(P(e),s=!0)},o(a){z(e),s=!1},d(a){a&&f(t),e&&e.d()}}}function Yt(l){let t,s;return t=new dt({props:{hideTasks:!0,$$slots:{"header-right":[Xt],"header-subtext":[jt],default:[Jt]},$$scope:{ctx:l}}}),{c(){G(t.$$.fragment)},l(e){U(t.$$.fragment,e)},m(e,a){H(t,e,a),s=!0},p(e,[a]){const n={};a&1050623&&(n.$$scope={dirty:a,ctx:e}),t.$set(n)},i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){z(t.$$.fragment,e),s=!1},d(e){L(t,e)}}}const Wt="";function Zt(l,t,s){let e;const a=At();$e(l,a,d=>s(1,e=d)),Ft(a);const n=St();let i=!1;Vt("rag",Wt,a,n,d=>$t(d,Ne()),d=>Nt(d,Ne()),()=>{s(2,i=!0)});let r,u,m,p="",g,R=!1,E,v=!1,h=null;function y(d){s(10,h=null),s(7,g=void 0),s(6,p=`${d.detail}`)}function I(){a.setQuestion(p)}const o=d=>{const{dataset:D,path:M,embedding:N}=d.detail;(D!=r||M!=u||N!=m)&&(s(3,r=D),s(4,u=M),s(5,m=N),a.setDatasetPathEmbedding(D,M,N))},b=()=>I();function T(d){g=d,s(7,g)}function k(d){R=d,s(8,R)}const q=d=>s(0,E=d.detail);return l.$$.update=()=>{l.$$.dirty&2&&(e.datasetNamespace!=null&&e.datasetName!=null&&s(3,r={namespace:e.datasetNamespace,name:e.datasetName}),e.path!=null&&s(4,u=e.path),e.embedding!=null&&s(5,m=e.embedding)),l.$$.dirty&2&&e.query!=null&&s(6,p=e.query),l.$$.dirty&1&&E!=null&&(s(9,v=!0),s(10,h=null),Dt.generateCompletion(E).then(d=>{s(10,h=d),s(9,v=!1)}))},[E,e,i,r,u,m,p,g,R,v,h,a,y,I,o,b,T,k,q]}class os extends ge{constructor(t){super(),ve(this,t,Zt,Yt,be,{})}}export{os as component};
