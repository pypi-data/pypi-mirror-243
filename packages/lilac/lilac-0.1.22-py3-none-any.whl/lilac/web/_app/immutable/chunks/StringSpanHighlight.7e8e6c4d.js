import{S as ee,i as te,s as le,D as U,Z as Q,_ as Z,m as y,h as _,n as w,$ as _e,b as P,a0 as k,K as Ce,a1 as z,M as J,Q as ae,q as R,r as A,u as j,k as C,y as oe,l as H,z as re,F as T,A as ce,a7 as de,W as st,g as N,d as I,B as ue,a as Y,c as q,v as x,f as $,a3 as Ke,a4 as Pe,N as at,G as fe,L as Qe,X as Ze,Y as ot,p as O,ah as rt,ao as ct,a2 as dt,O as we,ai as ut,e as Ve,a8 as Be}from"./index.6d58eddb.js";import{ay as Le,L as ft,h as Je,N as ht,_ as Se,X as xe,a8 as $e,aj as mt,ai as K,a2 as Ee,d as gt,b3 as _t,al as pt,b7 as bt,bx as vt,av as kt,by as yt,bp as wt}from"./Commands.83bc508c.js";import{f as Te,g as St}from"./notificationsStore.d43d4d83.js";import{c as Ne,L as Ie,a as Me}from"./colors.f6cbcb11.js";function ze(n){let e,t;return{c(){e=Q("title"),t=R(n[1])},l(l){e=Z(l,"title",{});var s=y(e);t=A(s,n[1]),s.forEach(_)},m(l,s){P(l,e,s),k(e,t)},p(l,s){s&2&&j(t,l[1])},d(l){l&&_(e)}}}function Et(n){let e,t,l=n[1]&&ze(n),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],d={};for(let i=0;i<s.length;i+=1)d=U(d,s[i]);return{c(){e=Q("svg"),l&&l.c(),t=Q("path"),this.h()},l(i){e=Z(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var o=y(e);l&&l.l(o),t=Z(o,"path",{d:!0}),y(t).forEach(_),o.forEach(_),this.h()},h(){w(t,"d","M2 2H7V16H2zM23 2H9V16.8027l3.0422 4.5635.8453 5.9165A2.0094 2.0094 0 0014.8672 29H15a3.0033 3.0033 0 003-3V20h8a4.0045 4.0045 0 004-4V9A7.0078 7.0078 0 0023 2z"),_e(e,d)},m(i,o){P(i,e,o),l&&l.m(e,null),k(e,t)},p(i,[o]){i[1]?l?l.p(i,o):(l=ze(i),l.c(),l.m(e,t)):l&&(l.d(1),l=null),_e(e,d=Ce(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},o&1&&{width:i[0]},o&1&&{height:i[0]},o&4&&i[2],o&8&&i[3]]))},i:z,o:z,d(i){i&&_(e),l&&l.d()}}}function Nt(n,e,t){let l,s;const d=["size","title"];let i=J(e,d),{size:o=16}=e,{title:a=void 0}=e;return n.$$set=r=>{t(5,e=U(U({},e),ae(r))),t(3,i=J(e,d)),"size"in r&&t(0,o=r.size),"title"in r&&t(1,a=r.title)},n.$$.update=()=>{t(4,l=e["aria-label"]||e["aria-labelledby"]||a),t(2,s={"aria-hidden":l?void 0:!0,role:l?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=ae(e),[o,a,s,i,l]}class Ct extends ee{constructor(e){super(),te(this,e,Nt,Et,le,{size:0,title:1})}}function Re(n){let e,t;return{c(){e=Q("title"),t=R(n[1])},l(l){e=Z(l,"title",{});var s=y(e);t=A(s,n[1]),s.forEach(_)},m(l,s){P(l,e,s),k(e,t)},p(l,s){s&2&&j(t,l[1])},d(l){l&&_(e)}}}function Ht(n){let e,t,l=n[1]&&Re(n),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],d={};for(let i=0;i<s.length;i+=1)d=U(d,s[i]);return{c(){e=Q("svg"),l&&l.c(),t=Q("path"),this.h()},l(i){e=Z(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var o=y(e);l&&l.l(o),t=Z(o,"path",{d:!0}),y(t).forEach(_),o.forEach(_),this.h()},h(){w(t,"d","M2 16H7V30H2zM23 30H9V15.1973l3.0422-4.5635.8453-5.9165A2.0094 2.0094 0 0114.8672 3H15a3.0033 3.0033 0 013 3v6h8a4.0045 4.0045 0 014 4v7A7.0078 7.0078 0 0123 30z"),_e(e,d)},m(i,o){P(i,e,o),l&&l.m(e,null),k(e,t)},p(i,[o]){i[1]?l?l.p(i,o):(l=Re(i),l.c(),l.m(e,t)):l&&(l.d(1),l=null),_e(e,d=Ce(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},o&1&&{width:i[0]},o&1&&{height:i[0]},o&4&&i[2],o&8&&i[3]]))},i:z,o:z,d(i){i&&_(e),l&&l.d()}}}function Pt(n,e,t){let l,s;const d=["size","title"];let i=J(e,d),{size:o=16}=e,{title:a=void 0}=e;return n.$$set=r=>{t(5,e=U(U({},e),ae(r))),t(3,i=J(e,d)),"size"in r&&t(0,o=r.size),"title"in r&&t(1,a=r.title)},n.$$.update=()=>{t(4,l=e["aria-label"]||e["aria-labelledby"]||a),t(2,s={"aria-hidden":l?void 0:!0,role:l?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=ae(e),[o,a,s,i,l]}class Vt extends ee{constructor(e){super(),te(this,e,Pt,Ht,le,{size:0,title:1})}}function Bt(n,e){const t=l=>n&&!n.contains(l.target)&&!l.defaultPrevented&&e();return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function Lt(n){let e=(n[1]?"":n[0])+"",t;return{c(){t=R(e)},l(l){t=A(l,e)},m(l,s){P(l,t,s)},p(l,s){s&3&&e!==(e=(l[1]?"":l[0])+"")&&j(t,e)},d(l){l&&_(t)}}}function Tt(n){let e,t,l,s,d;const i=[n[2],{type:"purple"},{icon:Le}];let o={$$slots:{default:[Lt]},$$scope:{ctx:n}};for(let a=0;a<i.length;a+=1)o=U(o,i[a]);return t=new ft({props:o}),{c(){e=C("div"),oe(t.$$.fragment),this.h()},l(a){e=H(a,"DIV",{class:!0});var r=y(e);re(t.$$.fragment,r),r.forEach(_),this.h()},h(){w(e,"class","embedding-badge truncate"),T(e,"embedding-badge-nolabel",n[1])},m(a,r){P(a,e,r),ce(t,e,null),l=!0,s||(d=de(Je.call(null,e,{text:"Embedding index"})),s=!0)},p(a,[r]){const c=r&4?Ce(i,[r&4&&st(a[2]),i[1],r&0&&{icon:Le}]):{};r&11&&(c.$$scope={dirty:r,ctx:a}),t.$set(c),(!l||r&2)&&T(e,"embedding-badge-nolabel",a[1])},i(a){l||(N(t.$$.fragment,a),l=!0)},o(a){I(t.$$.fragment,a),l=!1},d(a){a&&_(e),ue(t),s=!1,d()}}}function It(n,e,t){const l=["embedding","hideEmbeddingName"];let s=J(e,l),{embedding:d}=e,{hideEmbeddingName:i=!1}=e;return n.$$set=o=>{e=U(U({},e),ae(o)),t(2,s=J(e,l)),"embedding"in o&&t(0,d=o.embedding),"hideEmbeddingName"in o&&t(1,i=o.hideEmbeddingName)},[d,i,s]}class Mt extends ee{constructor(e){super(),te(this,e,It,Tt,le,{embedding:0,hideEmbeddingName:1})}}function Ae(n,e,t){const l=n.slice();return l[12]=e[t],l}function De(n){let e,t,l=n[0].conceptNamespace+"",s,d,i=n[0].conceptName+"",o,a,r,c,u,h,m,v,g,p,b;return u=new Vt({}),v=new Ct({}),{c(){e=C("div"),t=C("div"),s=R(l),d=R(" / "),o=R(i),a=Y(),r=C("div"),c=C("button"),oe(u.$$.fragment),h=Y(),m=C("button"),oe(v.$$.fragment),this.h()},l(S){e=H(S,"DIV",{class:!0});var B=y(e);t=H(B,"DIV",{class:!0});var M=y(t);s=A(M,l),d=A(M," / "),o=A(M,i),M.forEach(_),a=q(B),r=H(B,"DIV",{class:!0});var V=y(r);c=H(V,"BUTTON",{class:!0});var L=y(c);re(u.$$.fragment,L),L.forEach(_),h=q(V),m=H(V,"BUTTON",{class:!0});var W=y(m);re(v.$$.fragment,W),W.forEach(_),V.forEach(_),B.forEach(_),this.h()},h(){w(t,"class","flex-grow"),w(c,"class","p-1"),w(m,"class","p-1"),w(r,"class","shrink-0"),w(e,"class","flex flex-row items-center justify-between gap-x-4 p-2")},m(S,B){P(S,e,B),k(e,t),k(t,s),k(t,d),k(t,o),k(e,a),k(e,r),k(r,c),ce(u,c,null),k(r,h),k(r,m),ce(v,m,null),g=!0,p||(b=[fe(c,"click",n[8]),fe(m,"click",n[9])],p=!0)},p(S,B){(!g||B&1)&&l!==(l=S[0].conceptNamespace+"")&&j(s,l),(!g||B&1)&&i!==(i=S[0].conceptName+"")&&j(o,i)},i(S){g||(N(u.$$.fragment,S),N(v.$$.fragment,S),g=!0)},o(S){I(u.$$.fragment,S),I(v.$$.fragment,S),g=!1},d(S){S&&_(e),ue(u),ue(v),p=!1,Qe(b)}}}function Oe(n){let e,t=[],l=new Map,s,d=n[2];const i=o=>o[12];for(let o=0;o<d.length;o+=1){let a=Ae(n,d,o),r=i(a);l.set(r,t[o]=Ue(r,a))}return{c(){e=C("div");for(let o=0;o<t.length;o+=1)t[o].c();this.h()},l(o){e=H(o,"DIV",{class:!0});var a=y(e);for(let r=0;r<t.length;r+=1)t[r].l(a);a.forEach(_),this.h()},h(){w(e,"class","more-button flex flex-col")},m(o,a){P(o,e,a);for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(e,null);s=!0},p(o,a){a&29&&(d=o[2],x(),t=Ze(t,a,i,1,o,d,l,e,ot,Ue,null,Ae),$())},i(o){if(!s){for(let a=0;a<d.length;a+=1)N(t[a]);s=!0}},o(o){for(let a=0;a<t.length;a+=1)I(t[a]);s=!1},d(o){o&&_(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function Ue(n,e){let t,l,s,d,i,o,a,r,c;i=new Mt({props:{class:"hover:cursor-pointer",embedding:e[12]}});function u(){return e[10](e[12])}return{key:n,first:null,c(){t=C("button"),l=C("div"),s=R("Find similar"),d=Y(),oe(i.$$.fragment),o=Y(),this.h()},l(h){t=H(h,"BUTTON",{class:!0});var m=y(t);l=H(m,"DIV",{});var v=y(l);s=A(v,"Find similar"),v.forEach(_),d=q(m),re(i.$$.fragment,m),o=q(m),m.forEach(_),this.h()},h(){w(t,"class","flex w-full items-center justify-between"),this.first=t},m(h,m){P(h,t,m),k(t,l),k(l,s),k(t,d),ce(i,t,null),k(t,o),a=!0,r||(c=fe(t,"click",u),r=!0)},p(h,m){e=h;const v={};m&4&&(v.embedding=e[12]),i.$set(v)},i(h){a||(N(i.$$.fragment,h),a=!0)},o(h){I(i.$$.fragment,h),a=!1},d(h){h&&_(t),ue(i),r=!1,c()}}}function zt(n){let e,t,l,s,d,i,o,a=n[0].conceptName!=null&&n[0].conceptNamespace!=null&&De(n),r=n[3]!=null&&Oe(n);return{c(){e=C("div"),a&&a.c(),t=Y(),r&&r.c(),this.h()},l(c){e=H(c,"DIV",{style:!0,class:!0});var u=y(e);a&&a.l(u),t=q(u),r&&r.l(u),u.forEach(_),this.h()},h(){w(e,"style",l=n[1]!=null?`left: ${n[1].x}px; top: ${n[1].y}px`:""),w(e,"class","absolute z-10 inline-flex -translate-x-1/2 translate-y-6 flex-col divide-y divide-gray-200 rounded border border-gray-200 bg-white shadow")},m(c,u){P(c,e,u),a&&a.m(e,null),k(e,t),r&&r.m(e,null),d=!0,i||(o=de(Bt.call(null,e,n[11])),i=!0)},p(c,[u]){c[0].conceptName!=null&&c[0].conceptNamespace!=null?a?(a.p(c,u),u&1&&N(a,1)):(a=De(c),a.c(),N(a,1),a.m(e,t)):a&&(x(),I(a,1,1,()=>{a=null}),$()),c[3]!=null?r?(r.p(c,u),u&8&&N(r,1)):(r=Oe(c),r.c(),N(r,1),r.m(e,null)):r&&(x(),I(r,1,1,()=>{r=null}),$()),(!d||u&2&&l!==(l=c[1]!=null?`left: ${c[1].x}px; top: ${c[1].y}px`:""))&&w(e,"style",l)},i(c){d||(N(a),N(r),Ke(()=>{d&&(s||(s=Pe(e,Te,{duration:60},!0)),s.run(1))}),d=!0)},o(c){I(a),I(r),s||(s=Pe(e,Te,{duration:60},!1)),s.run(0),d=!1},d(c){c&&_(e),a&&a.d(),r&&r.d(),c&&s&&s.end(),i=!1,o()}}}function Rt(n,e,t){let{details:l}=e,{clickPosition:s}=e,{embeddings:d}=e,{addConceptLabel:i}=e,{findSimilar:o}=e,{addNotification:a}=e;const r=at();function c(g){if(!l.conceptName||!l.conceptNamespace)throw Error("Label could not be added, no active concept.");i(l.conceptNamespace,l.conceptName,l.text,g),a({kind:"success",title:`[${g===!0?"Positive":"Negative"}] Concept label added`,subtitle:ht(l.conceptNamespace,l.conceptName),message:l.text}),r("click")}const u=()=>c(!0),h=()=>c(!1),m=g=>{o&&o(g,l.text),r("click")},v=()=>r("close");return n.$$set=g=>{"details"in g&&t(0,l=g.details),"clickPosition"in g&&t(1,s=g.clickPosition),"embeddings"in g&&t(2,d=g.embeddings),"addConceptLabel"in g&&t(6,i=g.addConceptLabel),"findSimilar"in g&&t(3,o=g.findSimilar),"addNotification"in g&&t(7,a=g.addNotification)},[l,s,d,o,r,c,i,a,u,h,m,v]}class At extends ee{constructor(e){super(),te(this,e,Rt,zt,le,{details:0,clickPosition:1,embeddings:2,addConceptLabel:6,findSimilar:3,addNotification:7})}}function Dt(n,e){let t,l=e;n.addEventListener("click",i=>s(i));function s(i){l.disabled||(t=new At({props:{details:l.details(),clickPosition:{x:i.clientX,y:i.clientY},embeddings:l.embeddings,addConceptLabel:l.addConceptLabel,addNotification:l.addNotification,findSimilar:l.findSimilar},target:document.body}),t.$on("close",d),t.$on("click",d))}function d(){t==null||t.$destroy(),t=void 0}return{update(i){l=i,t==null||t.$set({details:l.details()})},destroy(){d()}}}function Fe(n,e,t){const l=n.slice();return l[7]=e[t],l}function je(n,e){let t,l,s=e[7].info.name+"",d,i,o,a,r=Ye(e[7])+"",c,u;return{key:n,first:null,c(){t=C("div"),l=C("div"),d=R(s),i=Y(),o=C("div"),a=C("span"),c=R(r),u=Y(),this.h()},l(h){t=H(h,"DIV",{class:!0});var m=y(t);l=H(m,"DIV",{class:!0});var v=y(l);d=A(v,s),v.forEach(_),i=q(m),o=H(m,"DIV",{class:!0});var g=y(o);a=H(g,"SPAN",{class:!0});var p=y(a);c=A(p,r),p.forEach(_),g.forEach(_),u=q(m),m.forEach(_),this.h()},h(){w(l,"class","named-value-name table-cell max-w-xs truncate pr-2 svelte-1689hje"),w(a,"class","px-1"),T(a,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!Se(e[7].info.dtype)),O(a,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?Ne(e[7].value):""),w(o,"class","table-cell rounded text-right"),w(t,"class","table-row"),this.first=t},m(h,m){P(h,t,m),k(t,l),k(l,d),k(t,i),k(t,o),k(o,a),k(a,c),k(t,u)},p(h,m){e=h,m&1&&s!==(s=e[7].info.name+"")&&j(d,s),m&1&&r!==(r=Ye(e[7])+"")&&j(c,r),m&1&&T(a,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!Se(e[7].info.dtype)),m&1&&O(a,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?Ne(e[7].value):"")},d(h){h&&_(t)}}}function Ot(n){let e,t,l=[],s=new Map,d,i=`${n[4]}px`,o=`${Math.min(n[1],n[3]-n[2]-20)}px`,a=n[0];const r=c=>c[7];for(let c=0;c<a.length;c+=1){let u=Fe(n,a,c),h=r(u);s.set(h,l[c]=je(h,u))}return{c(){e=C("div"),t=C("div");for(let c=0;c<l.length;c+=1)l[c].c();this.h()},l(c){e=H(c,"DIV",{role:!0,class:!0});var u=y(e);t=H(u,"DIV",{class:!0});var h=y(t);for(let m=0;m<l.length;m+=1)l[m].l(h);h.forEach(_),u.forEach(_),this.h()},h(){w(t,"class","table border-spacing-y-2"),w(e,"role","tooltip"),w(e,"class","absolute max-w-fit -translate-y-full break-words border border-gray-300 bg-white px-2 shadow-md"),Ke(()=>n[6].call(e)),T(e,"hidden",n[0].length===0),O(e,"top",i),O(e,"left",o)},m(c,u){P(c,e,u),k(e,t);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(t,null);d=rt(e,n[6].bind(e))},p(c,[u]){u&1&&(a=c[0],l=Ze(l,u,r,1,c,a,s,t,ct,je,null,Fe)),u&1&&T(e,"hidden",c[0].length===0),u&6&&o!==(o=`${Math.min(c[1],c[3]-c[2]-20)}px`)&&O(e,"left",o)},i:z,o:z,d(c){c&&_(e);for(let u=0;u<l.length;u+=1)l[u].d();d()}}}function Ye(n){return typeof n.value=="number"?n.value.toFixed(3):n.info.dtype.type==="string_span"?"true":n.value}function Ut(n,e,t){let{namedValues:l}=e,{x:s}=e,{y:d}=e;const i=window.innerWidth;let o=0;const a=d-1;function r(){o=this.clientWidth,t(2,o)}return n.$$set=c=>{"namedValues"in c&&t(0,l=c.namedValues),"x"in c&&t(1,s=c.x),"y"in c&&t(5,d=c.y)},[l,s,o,i,a,d,r]}class Ft extends ee{constructor(e){super(),te(this,e,Ut,Ot,le,{namedValues:0,x:1,y:5})}}function jt(n,e){let t,l=e;const s=()=>i();l.isHovered&&d();function d(){const o=l.namedValues.filter(h=>Array.from(l.spansHovered).some(m=>{const v=xe(m);return $e(h.specificPath.slice(0,v.length),v)}));l.itemScrollContainer!=null&&l.itemScrollContainer.addEventListener("scroll",s);const a=n.getBoundingClientRect(),r=window.getComputedStyle(n),c=parseInt(r.getPropertyValue("line-height")),u=a.height>c?a.x+n.offsetLeft||n.clientLeft:a.x;t=new Ft({props:{namedValues:o,x:u,y:a.top},target:document.body})}function i(){var o;t==null||t.$destroy(),(o=l.itemScrollContainer)==null||o.removeEventListener("scroll",s)}return{update(o){i(),l=o,l.isHovered&&d()},destroy(){i()}}}const pe=600,ge=50;function Yt(n,e,t){const l=[],s=new Set;for(const d of n){let i=!1;const o=[];for(const b of d.paths)s.has(b)||(o.push(b),s.add(b));const a=[],r=[];let c=-1/0;for(const[b,S]of Object.entries(d.originalSpans)){const B=e[b],M=xe(b);if(!(B==null||B.length===0))for(const V of S)for(const L of B){const W=L.path.slice(M.length),F=mt(V,W);if(F==null)continue;const D=K.value(F),he=K.span(F);if(D==null&&he==null)continue;if(L.dtype.type==="float32"){const ne=K.value(F);ne!=null&&(c=Math.max(c,ne))}const me=Ee(K.path(V)),be=!o.includes(me),X={value:D,info:L,specificPath:K.path(F)};be||a.push(X),r.push(X),L.type==="concept_score"||L.type==="semantic_similarity"?D>.5&&(i=!0):i=!0}}const u=r.some(b=>b.info.type==="label"),h=r.some(b=>b.info.type==="leaf_span"),m=r.some(b=>b.info.type==="keyword"),v=r.some(b=>b.info.type==="metadata"&&!Se(b.info.dtype)),g=d.paths.some(b=>t.has(b)),p=g&&o.length>0&&Array.from(t).some(b=>o.includes(b));l.push({backgroundColor:Ne(c),isBlackBolded:m||v||h,isHighlightBolded:u,isHighlighted:i,snippetScore:c,namedValues:a,paths:d.paths,text:d.text,originalSpans:d.originalSpans,isHovered:g,isFirstHover:p})}return l}function qt(n,e){var d;let t=!1,l=!1,s=[];for(let i=0;i<n.length;i++){const o=n[i],a=i-1>=0?n[i-1]:null,r=i+1<n.length?n[i+1]:null,c=(d=s.at(-1))==null?void 0:d.isEllipsis;if(!o.isHighlighted){if(c||a!=null&&a.isHighlighted||r!=null&&r.isHighlighted)continue;t=!0,s.push({isEllipsis:!0});continue}l=!0,a!=null&&!a.isHighlighted&&(!c&&a.text.length>ge&&(s.push({isEllipsis:!0}),t=!0),s.push({renderSpan:a,snippetText:a.text.slice(-ge)})),s.push({renderSpan:o,snippetText:o.text}),r!=null&&!r.isHighlighted&&(s.push({renderSpan:r,snippetText:r.text.slice(0,ge)}),!c&&r.text.length>ge&&(s.push({isEllipsis:!0}),t=!0))}return l||(s=[],t=!1,s.push({renderSpan:n[0],snippetText:n[0].text.slice(0,pe)}),((n[1]||null)!=null||n[0].text.length>pe)&&(s.push({isEllipsis:!0}),t=!0)),e&&(s=n.map(i=>({renderSpan:i,snippetText:i.text}))),{snippetSpans:s,textIsOverBudget:t}}function qe(n,e,t){const l=n.slice();return l[34]=e[t],l}function Wt(n){const e=n.slice(),t=e[34].renderSpan;return e[37]=t,e}function Xt(n){let e,t,l,s;return{c(){e=C("span"),t=R("..."),this.h()},l(d){e=H(d,"SPAN",{class:!0});var i=y(e);t=A(i,"..."),i.forEach(_),this.h()},h(){w(e,"class","highlight-span text-sm leading-5 svelte-nwcx2h")},m(d,i){P(d,e,i),k(e,t),l||(s=de(Je.call(null,e,{text:`Some text was hidden to improve readability. 
Click "Show all" to show the entire document.`})),l=!0)},p:z,i:z,o:z,d(d){d&&_(e),l=!1,s()}}}function Gt(n){let e,t,l,s,d,i,o,a;const r=[Qt,Kt],c=[];function u(g,p){return g[2]?0:1}t=u(n),l=c[t]=r[t](n);function h(){return n[30](n[37])}function m(){return n[31](n[37])}function v(){return n[32](n[37])}return{c(){e=C("span"),l.c(),this.h()},l(g){e=H(g,"SPAN",{class:!0});var p=y(e);l.l(p),p.forEach(_),this.h()},h(){w(e,"class","hover:cursor-poiner highlight-span break-words text-sm leading-5 svelte-nwcx2h"),T(e,"highlighted",n[37].isHighlighted),T(e,"hover:cursor-pointer",n[1].length>0),T(e,"font-bold",n[37].isBlackBolded),T(e,"font-medium",n[37].isHighlightBolded&&!n[37].isBlackBolded),O(e,"color",n[37].isHighlightBolded&&!n[37].isBlackBolded?Ie:""),O(e,"background-color",n[37].isHovered?Me(Xe):n[37].backgroundColor)},m(g,p){P(g,e,p),c[t].m(e,null),i=!0,o||(a=[de(s=jt.call(null,e,{namedValues:n[37].namedValues,isHovered:n[37].isFirstHover,spansHovered:n[5],itemScrollContainer:n[8]})),de(d=Dt.call(null,e,{details:h,findSimilar:n[9].page==="datasets"?n[17]:null,embeddings:n[3],addConceptLabel:n[15],addNotification:n[18]!=null?n[18].addNotification:Ge,disabled:n[37].paths.length===0||n[3].length===0})),fe(e,"mouseenter",m),fe(e,"mouseleave",v)],o=!0)},p(g,p){n=g;let b=t;t=u(n),t===b?c[t].p(n,p):(x(),I(c[b],1,1,()=>{c[b]=null}),$(),l=c[t],l?l.p(n,p):(l=c[t]=r[t](n),l.c()),N(l,1),l.m(e,null)),s&&Be(s.update)&&p[0]&352&&s.update.call(null,{namedValues:n[37].namedValues,isHovered:n[37].isFirstHover,spansHovered:n[5],itemScrollContainer:n[8]}),d&&Be(d.update)&&p[0]&584&&d.update.call(null,{details:h,findSimilar:n[9].page==="datasets"?n[17]:null,embeddings:n[3],addConceptLabel:n[15],addNotification:n[18]!=null?n[18].addNotification:Ge,disabled:n[37].paths.length===0||n[3].length===0}),(!i||p[0]&64)&&T(e,"highlighted",n[37].isHighlighted),(!i||p[0]&2)&&T(e,"hover:cursor-pointer",n[1].length>0),(!i||p[0]&64)&&T(e,"font-bold",n[37].isBlackBolded),(!i||p[0]&64)&&T(e,"font-medium",n[37].isHighlightBolded&&!n[37].isBlackBolded),p[0]&64&&O(e,"color",n[37].isHighlightBolded&&!n[37].isBlackBolded?Ie:""),p[0]&64&&O(e,"background-color",n[37].isHovered?Me(Xe):n[37].backgroundColor)},i(g){i||(N(l),i=!0)},o(g){I(l),i=!1},d(g){g&&_(e),c[t].d(),o=!1,Qe(a)}}}function Kt(n){let e=n[34].snippetText+"",t;return{c(){t=R(e)},l(l){t=A(l,e)},m(l,s){P(l,t,s)},p(l,s){s[0]&64&&e!==(e=l[34].snippetText+"")&&j(t,e)},i:z,o:z,d(l){l&&_(t)}}}function Qt(n){let e,t,l;return e=new wt({props:{source:n[34].snippetText}}),{c(){oe(e.$$.fragment),t=Y()},l(s){re(e.$$.fragment,s),t=q(s)},m(s,d){ce(e,s,d),P(s,t,d),l=!0},p(s,d){const i={};d[0]&64&&(i.source=s[34].snippetText),e.$set(i)},i(s){l||(N(e.$$.fragment,s),l=!0)},o(s){I(e.$$.fragment,s),l=!1},d(s){ue(e,s),s&&_(t)}}}function We(n){let e,t,l,s;const d=[Gt,Xt],i=[];function o(r,c){return r[34].isEllipsis?1:0}function a(r,c){return c===0?Wt(r):r}return e=o(n),t=i[e]=d[e](a(n,e)),{c(){t.c(),l=Ve()},l(r){t.l(r),l=Ve()},m(r,c){i[e].m(r,c),P(r,l,c),s=!0},p(r,c){let u=e;e=o(r),e===u?i[e].p(a(r,e),c):(x(),I(i[u],1,1,()=>{i[u]=null}),$(),t=i[e],t?t.p(a(r,e),c):(t=i[e]=d[e](a(r,e)),t.c()),N(t,1),t.m(l.parentNode,l))},i(r){s||(N(t),s=!0)},o(r){I(t),s=!1},d(r){i[e].d(r),r&&_(l)}}}function Zt(n){let e,t,l=n[6],s=[];for(let i=0;i<l.length;i+=1)s[i]=We(qe(n,l,i));const d=i=>I(s[i],1,1,()=>{s[i]=null});return{c(){e=C("div");for(let i=0;i<s.length;i+=1)s[i].c();this.h()},l(i){e=H(i,"DIV",{class:!0});var o=y(e);for(let a=0;a<s.length;a+=1)s[a].l(o);o.forEach(_),this.h()},h(){w(e,"class","overflow-x-hidden text-ellipsis whitespace-break-spaces svelte-nwcx2h"),T(e,"text-preview-overlay",n[0]&&n[7]>pe&&!n[4])},m(i,o){P(i,e,o);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);t=!0},p(i,o){if(o[0]&441198){l=i[6];let a;for(a=0;a<l.length;a+=1){const r=qe(i,l,a);s[a]?(s[a].p(r,o),N(s[a],1)):(s[a]=We(r),s[a].c(),N(s[a],1),s[a].m(e,null))}for(x(),a=l.length;a<s.length;a+=1)d(a);$()}(!t||o[0]&145)&&T(e,"text-preview-overlay",i[0]&&i[7]>pe&&!i[4])},i(i){if(!t){for(let o=0;o<l.length;o+=1)N(s[o]);t=!0}},o(i){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)I(s[o]);t=!1},d(i){i&&_(e),dt(s,i)}}}const Xe=.9,Ge=()=>null;function Jt(n,e,t){let l,s,d,i,o,{text:a}=e,{row:r}=e,{field:c=void 0}=e,{spanPaths:u}=e,{path:h=void 0}=e,{valuePaths:m}=e,{markdown:v=!1}=e,{embeddings:g}=e,{datasetViewStore:p=void 0}=e,{isExpanded:b=!1}=e,{textIsOverBudget:S=!1}=e;const B=gt();we(n,B,f=>t(9,o=f));let M,V={},L=new Set;const W=f=>{f.paths.forEach(E=>L.add(E)),t(5,L)},F=f=>{f.paths.forEach(E=>L.delete(E)),t(5,L)};let D={};const he=f=>{const G={conceptName:null,conceptNamespace:null,text:s.filter(ie=>ie.paths.some(ye=>((f==null?void 0:f.paths)||[]).some(se=>$e(se,ye)))).map(ie=>ie.text).join("")};for(const ie of Object.keys(f.originalSpans)){const ye=(V[ie]||[]).filter(se=>se.type==="concept_score");for(const se of ye){const He=se.signal;G.conceptName=He.concept_name,G.conceptNamespace=He.namespace;break}}return G},me=_t();we(n,me,f=>t(33,d=f));const be=(f,E,ke,G)=>{if(!E||!f)throw Error("Label could not be added, no active concept.");d.mutate([f,E,{insert:[{text:ke,label:G}]}])};let X,ne=ut(pt);we(n,ne,f=>t(8,i=f));const et=(f,E)=>{p==null||c==null||p.addSearch({path:c.path,type:"semantic",query_type:"document",query:E,embedding:f})},tt=St();let ve=0;const lt=f=>he(f),nt=f=>W(f),it=f=>F(f);return n.$$set=f=>{"text"in f&&t(19,a=f.text),"row"in f&&t(20,r=f.row),"field"in f&&t(21,c=f.field),"spanPaths"in f&&t(1,u=f.spanPaths),"path"in f&&t(22,h=f.path),"valuePaths"in f&&t(23,m=f.valuePaths),"markdown"in f&&t(2,v=f.markdown),"embeddings"in f&&t(3,g=f.embeddings),"datasetViewStore"in f&&t(24,p=f.datasetViewStore),"isExpanded"in f&&t(4,b=f.isExpanded),"textIsOverBudget"in f&&t(0,S=f.textIsOverBudget)},n.$$.update=()=>{if(n.$$.dirty[0]&5242882&&(t(25,M={}),u.forEach(f=>{let E=bt(r,f);vt(f,h)&&(E=E.filter(G=>kt(K.path(G),h)||h==null)),t(25,M[Ee(f)]=E,M)})),n.$$.dirty[0]&75497472){t(26,V={});for(const f of m){const E=Ee(f.spanPath);V[E]==null&&t(26,V[E]=[],V),V[E].push(f)}}if(n.$$.dirty[0]&34078720&&t(29,l=yt(a,M)),n.$$.dirty[0]&603979808&&t(28,s=Yt(l,V,L)),n.$$.dirty[0]&671088640){t(27,D={});for(const f of l)for(const E of f.paths)t(27,D[E]=D[E]||[],D),D[E].push(f)}if(n.$$.dirty[0]&268435472&&t(6,{snippetSpans:X,textIsOverBudget:S}=qt(s,b),X,(t(0,S),t(28,s),t(4,b),t(29,l),t(26,V),t(5,L),t(19,a),t(25,M),t(23,m),t(1,u),t(20,r),t(22,h))),n.$$.dirty[0]&192){t(7,ve=0);for(const f of X)f.isEllipsis||t(7,ve+=f.snippetText.length)}},[S,u,v,g,b,L,X,ve,i,o,B,W,F,he,me,be,ne,et,tt,a,r,c,h,m,p,M,V,D,s,l,lt,nt,it]}class ll extends ee{constructor(e){super(),te(this,e,Jt,Zt,le,{text:19,row:20,field:21,spanPaths:1,path:22,valuePaths:23,markdown:2,embeddings:3,datasetViewStore:24,isExpanded:4,textIsOverBudget:0},null,[-1,-1])}}export{Mt as E,ll as S,Vt as T,Ct as a,Bt as c};
