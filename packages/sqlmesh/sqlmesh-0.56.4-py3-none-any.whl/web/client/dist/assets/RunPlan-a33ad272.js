import{r as p,v as q,D as z,y as _,w as me,x as E,R as X,z as pe,A as se,B as O,X as B,I as J,F as ie,G as fe,H as xe,J as K,K as ve,T as he,M as g,Q as ge,U as H,V as ye,W as Z,Y as le,Z as be,u as oe,$ as T,a as b,a0 as Ie,o as N,j as t,d as R,a1 as L,a2 as $,c as k,S as ce,e as C,a3 as we,a4 as ue,a5 as ee,a6 as V,a7 as Ee,k as Re,a8 as je,E as Ne}from"./index-10cf6bcc.js";import{C as Pe,I as te}from"./SearchList-ef742eab.js";import{F as Se,E as S,C as ke,P as ne}from"./PlanChangePreview-6e7c1aa9.js";import{c as De,d as Me,e as P,x as Ce}from"./context-eed4063d.js";import{s as Ae,k as ae}from"./popover-e2907f5e.js";import{M as Fe}from"./disclosure-e6c452a2.js";import"./ModelLineage-1440e33b.js";import"./PlusIcon-932d8943.js";import"./_commonjs-dynamic-modules-302442b1.js";function Te({title:e,titleId:r,...i},s){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:s,"aria-labelledby":r},i),e?p.createElement("title",{id:r},e):null,p.createElement("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"}))}const $e=p.forwardRef(Te),Oe=$e;var Le=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Le||{}),ze=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(ze||{}),_e=(e=>(e[e.OpenMenu=0]="OpenMenu",e[e.CloseMenu=1]="CloseMenu",e[e.GoToItem=2]="GoToItem",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterItem=5]="RegisterItem",e[e.UnregisterItem=6]="UnregisterItem",e))(_e||{});function G(e,r=i=>i){let i=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,s=be(r(e.items.slice()),m=>m.dataRef.current.domRef.current),l=i?s.indexOf(i):null;return l===-1&&(l=null),{items:s,activeItemIndex:l}}let Be={1(e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},0(e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},2:(e,r)=>{var i;let s=G(e),l=Ce(r,{resolveItems:()=>s.items,resolveActiveIndex:()=>s.activeItemIndex,resolveId:m=>m.id,resolveDisabled:m=>m.dataRef.current.disabled});return{...e,...s,searchQuery:"",activeItemIndex:l,activationTrigger:(i=r.trigger)!=null?i:1}},3:(e,r)=>{let i=e.searchQuery!==""?0:1,s=e.searchQuery+r.value.toLowerCase(),l=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+i).concat(e.items.slice(0,e.activeItemIndex+i)):e.items).find(o=>{var n;return((n=o.dataRef.current.textValue)==null?void 0:n.startsWith(s))&&!o.dataRef.current.disabled}),m=l?e.items.indexOf(l):-1;return m===-1||m===e.activeItemIndex?{...e,searchQuery:s}:{...e,searchQuery:s,activeItemIndex:m,activationTrigger:1}},4(e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},5:(e,r)=>{let i=G(e,s=>[...s,{id:r.id,dataRef:r.dataRef}]);return{...e,...i}},6:(e,r)=>{let i=G(e,s=>{let l=s.findIndex(m=>m.id===r.id);return l!==-1&&s.splice(l,1),s});return{...e,...i,activationTrigger:1}}},W=p.createContext(null);W.displayName="MenuContext";function Q(e){let r=p.useContext(W);if(r===null){let i=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,Q),i}return r}function Qe(e,r){return se(r.type,Be,e,r)}let Ue=p.Fragment;function Ke(e,r){let{__demoMode:i=!1,...s}=e,l=p.useReducer(Qe,{__demoMode:i,menuState:i?0:1,buttonRef:p.createRef(),itemsRef:p.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:m,itemsRef:o,buttonRef:n},c]=l,x=_(r);me([n,o],(I,w)=>{var u;c({type:1}),ve(w,he.Loose)||(I.preventDefault(),(u=n.current)==null||u.focus())},m===0);let h=E(()=>{c({type:1})}),f=p.useMemo(()=>({open:m===0,close:h}),[m,h]),v={ref:x};return X.createElement(W.Provider,{value:l},X.createElement(pe,{value:se(m,{0:O.Open,1:O.Closed})},B({ourProps:v,theirProps:s,slot:f,defaultTag:Ue,name:"Menu"})))}let Ve="button";function Ge(e,r){var i;let s=J(),{id:l=`headlessui-menu-button-${s}`,...m}=e,[o,n]=Q("Menu.Button"),c=_(o.buttonRef,r),x=ie(),h=E(u=>{switch(u.key){case g.Space:case g.Enter:case g.ArrowDown:u.preventDefault(),u.stopPropagation(),n({type:0}),x.nextFrame(()=>n({type:2,focus:P.First}));break;case g.ArrowUp:u.preventDefault(),u.stopPropagation(),n({type:0}),x.nextFrame(()=>n({type:2,focus:P.Last}));break}}),f=E(u=>{switch(u.key){case g.Space:u.preventDefault();break}}),v=E(u=>{if(ge(u.currentTarget))return u.preventDefault();e.disabled||(o.menuState===0?(n({type:1}),x.nextFrame(()=>{var d;return(d=o.buttonRef.current)==null?void 0:d.focus({preventScroll:!0})})):(u.preventDefault(),n({type:0})))}),I=p.useMemo(()=>({open:o.menuState===0}),[o]),w={ref:c,id:l,type:Ae(e,o.buttonRef),"aria-haspopup":"menu","aria-controls":(i=o.itemsRef.current)==null?void 0:i.id,"aria-expanded":o.menuState===0,onKeyDown:h,onKeyUp:f,onClick:v};return B({ourProps:w,theirProps:m,slot:I,defaultTag:Ve,name:"Menu.Button"})}let He="div",Je=q.RenderStrategy|q.Static;function We(e,r){var i,s;let l=J(),{id:m=`headlessui-menu-items-${l}`,...o}=e,[n,c]=Q("Menu.Items"),x=_(n.itemsRef,r),h=fe(n.itemsRef),f=ie(),v=xe(),I=(()=>v!==null?(v&O.Open)===O.Open:n.menuState===0)();p.useEffect(()=>{let a=n.itemsRef.current;a&&n.menuState===0&&a!==(h==null?void 0:h.activeElement)&&a.focus({preventScroll:!0})},[n.menuState,n.itemsRef,h]),Se({container:n.itemsRef.current,enabled:n.menuState===0,accept(a){return a.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:a.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(a){a.setAttribute("role","none")}});let w=E(a=>{var D,M;switch(f.dispose(),a.key){case g.Space:if(n.searchQuery!=="")return a.preventDefault(),a.stopPropagation(),c({type:3,value:a.key});case g.Enter:if(a.preventDefault(),a.stopPropagation(),c({type:1}),n.activeItemIndex!==null){let{dataRef:y}=n.items[n.activeItemIndex];(M=(D=y.current)==null?void 0:D.domRef.current)==null||M.click()}le(n.buttonRef.current);break;case g.ArrowDown:return a.preventDefault(),a.stopPropagation(),c({type:2,focus:P.Next});case g.ArrowUp:return a.preventDefault(),a.stopPropagation(),c({type:2,focus:P.Previous});case g.Home:case g.PageUp:return a.preventDefault(),a.stopPropagation(),c({type:2,focus:P.First});case g.End:case g.PageDown:return a.preventDefault(),a.stopPropagation(),c({type:2,focus:P.Last});case g.Escape:a.preventDefault(),a.stopPropagation(),c({type:1}),H().nextFrame(()=>{var y;return(y=n.buttonRef.current)==null?void 0:y.focus({preventScroll:!0})});break;case g.Tab:a.preventDefault(),a.stopPropagation(),c({type:1}),H().nextFrame(()=>{ye(n.buttonRef.current,a.shiftKey?Z.Previous:Z.Next)});break;default:a.key.length===1&&(c({type:3,value:a.key}),f.setTimeout(()=>c({type:4}),350));break}}),u=E(a=>{switch(a.key){case g.Space:a.preventDefault();break}}),d=p.useMemo(()=>({open:n.menuState===0}),[n]),j={"aria-activedescendant":n.activeItemIndex===null||(i=n.items[n.activeItemIndex])==null?void 0:i.id,"aria-labelledby":(s=n.buttonRef.current)==null?void 0:s.id,id:m,onKeyDown:w,onKeyUp:u,role:"menu",tabIndex:0,ref:x};return B({ourProps:j,theirProps:o,slot:d,defaultTag:He,features:Je,visible:I,name:"Menu.Items"})}let Ye=p.Fragment;function qe(e,r){let i=J(),{id:s=`headlessui-menu-item-${i}`,disabled:l=!1,...m}=e,[o,n]=Q("Menu.Item"),c=o.activeItemIndex!==null?o.items[o.activeItemIndex].id===s:!1,x=p.useRef(null),h=_(r,x);K(()=>{if(o.__demoMode||o.menuState!==0||!c||o.activationTrigger===0)return;let y=H();return y.requestAnimationFrame(()=>{var U,Y;(Y=(U=x.current)==null?void 0:U.scrollIntoView)==null||Y.call(U,{block:"nearest"})}),y.dispose},[o.__demoMode,x,c,o.menuState,o.activationTrigger,o.activeItemIndex]);let f=De(x),v=p.useRef({disabled:l,domRef:x,get textValue(){return f()}});K(()=>{v.current.disabled=l},[v,l]),K(()=>(n({type:5,id:s,dataRef:v}),()=>n({type:6,id:s})),[v,s]);let I=E(()=>{n({type:1})}),w=E(y=>{if(l)return y.preventDefault();n({type:1}),le(o.buttonRef.current)}),u=E(()=>{if(l)return n({type:2,focus:P.Nothing});n({type:2,focus:P.Specific,id:s})}),d=Me(),j=E(y=>d.update(y)),a=E(y=>{d.wasMoved(y)&&(l||c||n({type:2,focus:P.Specific,id:s,trigger:0}))}),D=E(y=>{d.wasMoved(y)&&(l||c&&n({type:2,focus:P.Nothing}))}),M=p.useMemo(()=>({active:c,disabled:l,close:I}),[c,l,I]);return B({ourProps:{id:s,ref:h,role:"menuitem",tabIndex:l===!0?void 0:-1,"aria-disabled":l===!0?!0:void 0,disabled:void 0,onClick:w,onFocus:u,onPointerEnter:j,onMouseEnter:j,onPointerMove:a,onMouseMove:a,onPointerLeave:D,onMouseLeave:D},theirProps:m,slot:M,defaultTag:Ye,name:"Menu.Item"})}let Xe=z(Ke),Ze=z(Ge),et=z(We),tt=z(qe),A=Object.assign(Xe,{Button:Ze,Items:et,Item:tt});function pt(){const{setIsPlanOpen:e}=oe(),r=T(a=>a.planOverview),i=T(a=>a.planApply),s=T(a=>a.setPlanOverview),l=b(a=>a.isRunningPlan),m=b(a=>a.addConfirmation),o=b(a=>a.setShowConfirmation),n=b(a=>a.environment),c=b(a=>a.environments),x=b(a=>a.hasSynchronizedEnvironments),[h,f]=p.useState(!1),{refetch:v,isFetching:I}=Ie(n.name,{planOptions:{skip_tests:!0,include_unmodified:!0}});p.useEffect(()=>{h&&(w(),f(!1)),!N(n.isSynchronized)&&v()},[n]);function w(){e(!0),r.reset(),s(r)}const d=(N(n.isDefault)||x())&&(N(n.isDefault)||N(n.isInitial)),j=I||r.isRunning||i.isRunning;return t.jsxs("div",{className:R("flex items-center",Re(n)&&"opacity-50 pointer-events-none cursor-not-allowed"),children:[t.jsxs("div",{className:"flex items-center relative",children:[t.jsxs(L,{className:R("mx-0",N(n.isInitial&&n.isDefault)&&"rounded-none rounded-l-lg border-r"),variant:$.Alternative,size:k.sm,onClick:a=>{a.stopPropagation(),l?e(!0):n.isDefault&&N(n.isInitial)?m({headline:"Running Plan Directly On Prod Environment!",description:"Are you sure you want to run your changes directly on prod? Safer choice will be to select or add new environment first.",yesText:`Yes, Run ${n.name}`,noText:"No, Cancel",action(){w()},children:t.jsxs("div",{className:"mt-5 pt-4",children:[t.jsx("h4",{className:"mb-2",children:`${c.size>1?"Select or ":""}Add Environment`}),t.jsxs("div",{className:"flex items-center relative",children:[c.size>1&&t.jsx(re,{className:"mr-2",side:"left",environment:n,showAddEnvironment:!1,onSelect:()=>{f(!0),o(!1)},size:k.md,disabled:j}),t.jsx(de,{className:"w-full",size:k.md,onAdd:()=>{f(!0),o(!1)}})]})]})}):w()},children:[l&&t.jsx(ce,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block",children:at(r,i)})]}),d&&t.jsx(re,{className:"rounded-none rounded-r-lg border-l mx-0",environment:n,disabled:j})]}),t.jsx(nt,{environment:n,isRunningPlanOverview:I||r.isRunning,isRunningPlanApply:i.isRunning})]})}function nt({environment:e,isRunningPlanOverview:r,isRunningPlanApply:i}){var l,m,o,n;const s=T(c=>c.planOverview);return t.jsx("span",{className:"flex align-center h-full w-full",children:t.jsx(t.Fragment,{children:r?t.jsxs("span",{className:"flex items-center ml-2",children:[t.jsx(ce,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block text-xs text-neutral-500",children:"Checking..."})]}):t.jsxs(t.Fragment,{children:[e.isInitial&&e.isLocal&&t.jsx("span",{title:"New",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-success-10 text-success-500 text-xs text-center font-bold",children:"New"}),s.isLatest&&[r,i,e.isLocal].every(N)&&t.jsx("span",{title:"Latest",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:t.jsx("span",{children:"Latest"})}),C(s.added)&&t.jsx(F,{headline:"Added Models",type:S.Add,changes:s.added??[]}),C((l=s.modified)==null?void 0:l.direct)&&t.jsx(F,{headline:"Direct Changes",type:S.Direct,changes:((m=s.modified)==null?void 0:m.direct.map(({model_name:c})=>c))??[]}),C((o=s.modified)==null?void 0:o.indirect)&&t.jsx(F,{headline:"Indirectly Modified",type:S.Indirect,changes:((n=s.modified)==null?void 0:n.indirect.map(({model_name:c})=>c))??[]}),C(s.removed)&&t.jsx(F,{headline:"Removed Models",type:S.Remove,changes:s.removed??[]})]})})})}function re({onSelect:e,environment:r,disabled:i,side:s=V.Right,className:l,showAddEnvironment:m=!0,size:o=k.sm}){const{addError:n}=oe(),c=b(u=>u.environments),x=b(u=>u.pinnedEnvironments),h=b(u=>u.defaultEnvironment),f=b(u=>u.setEnvironment),v=b(u=>u.removeLocalEnvironment),I=we(A.Button);function w(u){je(u.name).then(()=>{v(u)}).catch(d=>{n(Ne.Environments,d)})}return t.jsx(A,{children:({close:u})=>t.jsxs(t.Fragment,{children:[t.jsxs(I,{variant:$.Alternative,size:o,disabled:i,className:R(l),children:[t.jsx("span",{className:R("block overflow-hidden truncate",(r.isLocal||i)&&"text-neutral-500",r.isSynchronized&&"text-primary-500"),children:r.name}),t.jsx("span",{className:"pointer-events-none inset-y-0 right-0 flex items-center pl-2",children:t.jsx(Pe,{className:"h-4 w-4","aria-hidden":"true"})})]}),t.jsx(ue,{as:p.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t.jsxs("div",{className:R("absolute top-9 overflow-hidden shadow-xl bg-theme border-2 border-primary-20 rounded-md flex flex-col z-10",s===V.Left&&"left-0",s===V.Right&&"right-0"),children:[t.jsxs(A.Items,{className:"overflow-auto max-h-80 py-2 hover:scrollbar scrollbar--vertical",children:[Array.from(c).map(d=>t.jsx(A.Item,{children:({active:j})=>t.jsxs("div",{onClick:a=>{a.stopPropagation(),f(d),e==null||e()},className:R("flex justify-between items-center pl-2 pr-1 py-1 cursor-pointer overflow-auto",j&&"bg-primary-10",d===r&&"pointer-events-none cursor-default bg-secondary-10"),children:[t.jsxs("div",{className:"flex items-start",children:[t.jsx(ke,{className:R("w-4 h-4 text-primary-500 mt-1.5",j&&"opacity-10",d!==r&&"opacity-0")}),t.jsxs("span",{className:"block",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx("span",{className:R("block truncate ml-2",d.isSynchronized&&"text-primary-500"),children:d.name}),t.jsxs("small",{className:"block ml-2",children:["(",d.type,")"]})]}),d.isDefault&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Main Environment"})}),h===d&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Default Environment"})})]})]}),t.jsxs("div",{className:"flex items-center",children:[d.isPinned&&t.jsx(Oe,{title:"Pinned",className:"w-4 text-primary-500 dark:text-primary-100 mx-1"}),d.isLocal&&N(d.isPinned)&&d!==r&&t.jsx(L,{className:"!m-0 !px-2 bg-transparent hover:bg-transparent border-none",size:k.xs,variant:$.Neutral,onClick:a=>{a.stopPropagation(),v(d)},children:t.jsx(Fe,{className:"w-4 text-neutral-500 dark:text-neutral-100"})}),N(d.isDefault)&&d!==r&&d.isSynchronized&&N(x.includes(d))&&t.jsx(L,{className:"!px-2 !my-0",size:k.xs,variant:$.Danger,onClick:a=>{a.stopPropagation(),w(d)},children:"Delete"})]})]})},d.name)),m&&t.jsxs(t.Fragment,{children:[t.jsx(ee,{}),t.jsx(de,{onAdd:u,className:"mt-2 px-2"})]})]}),t.jsx(ee,{})]})})]})})}function de({onAdd:e,className:r,label:i="Add",size:s=k.sm}){const l=b(f=>f.getNextEnvironment),m=b(f=>f.isExistingEnvironment),o=b(f=>f.addLocalEnvironment),[n,c]=p.useState(""),[x,h]=p.useState(l().name);return t.jsxs("div",{className:R("flex w-full items-center",r),children:[t.jsx(te,{className:"my-0 mx-0 mr-4 min-w-[10rem] w-full",size:s,children:({className:f})=>t.jsx(te.Textfield,{className:R(f,"w-full"),placeholder:"Environment",value:n,onInput:v=>{v.stopPropagation(),c(v.target.value)}})}),t.jsx(L,{className:"my-0 mx-0 font-bold",size:s,disabled:Ee(n)||m(n),onClick:f=>{f.stopPropagation(),o(n,x),c(""),h(l().name),e==null||e()},children:i})]})}function F({headline:e,type:r,changes:i}){const[s,l]=p.useState(!1);return t.jsx(ae,{onMouseEnter:()=>{l(!0)},onMouseLeave:()=>{l(!1)},className:"relative flex",children:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:R("inline-block ml-1 px-2 rounded-full text-xs font-bold text-neutral-100 cursor-default border border-inherit",r===S.Add&&"bg-success-500 border-success-500",r===S.Remove&&"bg-danger-500 border-danger-500",r===S.Direct&&"bg-secondary-500 border-secondary-500",r===S.Indirect&&"bg-warning-500 border-warning-500",r===S.Default&&"bg-neutral-500 border-neutral-500"),children:i.length}),t.jsx(ue,{show:s,as:p.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:t.jsx(ae.Panel,{className:"absolute right-1 z-10 mt-8 transform flex p-2 bg-theme-lighter shadow-xl focus:ring-2 ring-opacity-5 rounded-lg ",children:t.jsx(ne,{headline:e,type:r,className:"w-full h-full max-w-[50vw] max-h-[40vh] overflow-hidden overflow-y-auto ",children:t.jsx(ne.Default,{type:r,changes:i})})})})]})})}function at(e,r){return r.isRunning?"Applying Plan...":e.isRunning?"Getting Changes...":"Plan"}export{pt as default};
