"use strict";const elIsClean=t=>{const e=t.getBoundingClientRect(),r=t.style?.display==="none"||t.hidden||t.disabled,o=e.width===0||e.height===0,s=t.tagName==="SCRIPT"||t.tagName==="STYLE";return!r&&!o&&!s},inputs=["a","button","textarea","select","details","label"],isInteractable=t=>inputs.includes(t.tagName.toLowerCase())||t.tagName.toLowerCase()==="input"&&t.type!=="hidden"||t.role==="button",isTextInsertable=t=>["input","textarea"].includes(t.tagName.toLowerCase()),emptyTagWhitelist=["input","textarea","select","button"],isEmpty=t=>{const e=t.tagName.toLowerCase();if(emptyTagWhitelist.includes(e))return!1;if("innerText"in t&&t.innerText.trim().length===0){const r=t.querySelector("svg"),o=t.querySelector("img");return!(r||o)}return!1};function getElementXPath(t){let e=[],r="";for(t&&t.ownerDocument!==window.document&&(r=`iframe[${t.getAttribute("iframe_index")}]`);t;){if(!t.tagName){t=t.parentNode;continue}let o=t.tagName.toLowerCase(),s=1,i=t.previousElementSibling;for(;i;)i.tagName===t.tagName&&s++,i=i.previousElementSibling;let n=t.nextElementSibling,a=!1;for(;n;){if(n.tagName===t.tagName){a=!0;break}n=n.nextElementSibling}if((s>1||a)&&(o+=`[${s}]`),t.id)return o+=`[@id="${t.id}"]`,e.unshift(o),"//"+e.join("/");if(t.className){const l=Array.from(t.classList).map(d=>`contains(concat(" ", normalize-space(@class), " "), " ${d} ")`).join(" and ");l.length>0&&(o+=`[${l}]`)}e.unshift(o),t=t.parentNode}return r+"//"+e.join("/")}function create_tagged_span(t){let e=document.createElement("span");return e.id="__tarsier_id",e.style.all="inherit",e.style.display="inline",e.style.color="white",e.style.backgroundColor="red",e.textContent=t,e}window.tagifyWebpage=(t=!1)=>{window.removeTags();let e=0,r={},o=[...document.body.querySelectorAll("*")];const s=document.getElementsByTagName("iframe");for(let i=0;i<s.length;i++)try{const n=s[i];console.log("iframe!",s[i]);const c=[...(n.contentDocument||n.contentWindow?.document).querySelectorAll("*")];c.forEach(l=>l.setAttribute("iframe_index",i)),o.push(...c)}catch(n){console.error("Cross-origin iframe:",n)}o.map(i=>{isInteractable(i)&&i.childNodes.forEach(n=>{const a=o.indexOf(n);a>-1&&o.splice(a,1)})});for(let i of o)if(!(isEmpty(i)||!elIsClean(i))){if(r[e]=getElementXPath(i),isInteractable(i))e++;else if(t)for(let n of Array.from(i.childNodes))n.nodeType===Node.TEXT_NODE&&/\S/.test(n.textContent||"")&&e++}e=0;for(let i of o){if(isEmpty(i)||!elIsClean(i))continue;const n=isTextInsertable(i)?`{${e}}`:`[${e}]`;let a=create_tagged_span(n);if(isInteractable(i))i.prepend(a),e++;else if(t){for(let c of Array.from(i.childNodes))if(c.nodeType===Node.TEXT_NODE&&/\S/.test(c.textContent||"")){let l=create_tagged_span(n);i.insertBefore(l,c),e++}}}return r},window.removeTags=()=>{document.querySelectorAll("#__tarsier_id").forEach(e=>e.remove())};
