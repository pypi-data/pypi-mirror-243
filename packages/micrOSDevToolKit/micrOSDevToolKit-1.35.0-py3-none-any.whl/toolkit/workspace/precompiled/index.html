<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicroPython Web Server</title>
</head>
<body>
    <img src="https://github.com/BxNxM/micrOS/blob/master/media/logo_mini.png?raw=true" alt="micrOS Logo">
    <h1>Hello from MicroPython Web Server!</h1>
    <p>This is a basic HTML page served by your micrOS web server.</p>

    <h2>⇥ REST API v1.0</h2>
    <p>❌LIMITATIONS: cannot start background task from rest api (&/&&) </p>
    <p>EXAMPLE: system heartbeat</p>

    <!-- Input field for string -->
    <label for="inputString">⚙️Enter micrOS command:</label>
    <input type="text" id="inputString">

    <!-- Button to send data -->
    <button onclick="sendData()">Send</button>

    <!-- Display generated URL -->
    <p id="generatedUrl"></p>
    <pre id="rest_response"></pre>          <!-- Using <pre> for preformatted text -->
    <p id="rest_response_time"></p>

    <script>
        function sendData() {
            // Get the current hostname from the URL
            const currentHostname = window.location.hostname;

            // Construct the base URL for the REST API
            const baseUrl = `http://${currentHostname}`;

            // Get the input string from the input field
            const inputString = document.getElementById('inputString').value;
            // Replace whitespaces with "/" characters
            const sanitizedInput = inputString.replace(/\s+/g, '/');
            // Concatenate the sanitized input string to the API endpoint
            const apiUrl = `${baseUrl}/rest/${sanitizedInput}`;

            // Display the generated URL on the webpage
            document.getElementById('generatedUrl').innerHTML = `Generated URL: ${apiUrl}`;

            // Record the start time
            const startTime = performance.now();
            let endTime;

            fetch(apiUrl)
                .then(response => {
                    // Record the end time
                    endTime = performance.now();

                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Handle the data received from the server
                    document.getElementById('rest_response').innerHTML = JSON.stringify(data, null, 4);

                    // Calculate and print the communication time (delta)
                    const delta = (endTime - startTime).toFixed(0);
                    document.getElementById('rest_response_time').innerHTML = `⏱Response time: ${delta} ms`;
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    </script>
</body>
</html>
